<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard IPSKA - Kementerian Perdagangan RI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root {
            --primary: #1E3A8A;
            --primary-light: #3B82F6;
            --secondary: #D4AF37; /* IPSKA secondary color */
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            --process: #8B5CF6;
            --dark: #1F2937;
            --light: #F9FAFB;
            --card-bg: #FFFFFF;
            --sidebar-bg: linear-gradient(180deg, #1E3A8A 0%, #1A237E 100%);
            --border-radius: 10px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: #F3F4F6;
            color: var(--dark);
            min-height: 100vh;
            font-size: 14px;
            line-height: 1.5;
            display: flex;
            flex-direction: column;
        }

        /* Main Content */
        .main-content {
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            overflow-x: hidden;
            flex-grow: 1;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-title h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
        }

        .page-title p {
            color: #6B7280;
            font-size: 0.9rem;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .search-bar {
            position: relative;
            width: 300px;
            min-width: 200px;
        }

        .search-bar input {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 2.5rem;
            border: none;
            border-radius: var(--border-radius);
            background: white;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .search-bar input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .search-bar i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9CA3AF;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notification-bell {
            position: relative;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: white;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .notification-bell:hover {
            background: #f0f0f0;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            border: 2px solid #F9FAFB;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
        }

        .user-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .user-role {
            font-size: 0.8rem;
            color: #6B7280;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 1.5rem;
            width: 100%;
        }

        /* Card Styles */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .card-lg {
            grid-column: span 8;
        }

        .card-md {
            grid-column: span 4;
        }

        .card-sm {
            grid-column: span 3;
        }

        .card-full {
            grid-column: 1 / -1;
        }
        
        .card-body {
            flex-grow: 1;
        }

        /* Stats Card */
        .stats-card {
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }

        .stats-card:hover {
            background-color: #f8f8f8;
        }

        .stats-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 0.5rem 0;
        }

        .stats-label {
            font-size: 0.9rem;
            color: #6B7280;
        }

        /* Progress Bar */
        .progress-container {
            margin-top: 1.5rem;
        }

        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: #E5E7EB;
            overflow: hidden;
            margin-bottom: 0.8rem;
        }

        .progress {
            height: 100%;
            display: flex;
        }

        .progress-segment {
            height: 100%;
        }

        /* Status Colors */
        .progress-segment.permohonan { background: var(--info); }
        .progress-segment.pemeriksaan { background: var(--process); }
        .progress-segment.persetujuan { background: var(--success); }
        .progress-segment.penerimaan { background: #059669; } /* New color for Penerimaan */
        .progress-segment.penerbitan { background: #06B6D4; }
        .progress-segment.penolakan { background: var(--danger); }
        .progress-segment.pengunggahan { background: var(--warning); }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #6B7280;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        /* Status Cards */
        .status-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .status-card {
            padding: 1rem;
            border-radius: var(--border-radius);
            text-align: center;
            background: white;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .status-card:hover {
            transform: translateY(-3px);
        }

        .status-card.permohonan { border-top: 3px solid var(--info); }
        .status-card.pemeriksaan { border-top: 3px solid var(--process); }
        .status-card.persetujuan { border-top: 3px solid var(--success); }
        .status-card.penerimaan { border-top: 3px solid #059669; }
        .status-card.penerbitan { border-top: 3px solid #06B6D4; }
        .status-card.penolakan { border-top: 3px solid var(--danger); }
        .status-card.pengunggahan { border-top: 3px solid var(--warning); }

        .status-value {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
        }

        .status-card.permohonan .status-value { color: var(--info); }
        .status-card.pemeriksaan .status-value { color: var(--process); }
        .status-card.persetujuan .status-value { color: var(--success); }
        .status-card.penerimaan .status-value { color: #059669; }
        .status-card.penerbitan .status-value { color: #06B6D4; }
        .status-card.penolakan .status-value { color: var(--danger); }
        .status-card.pengunggahan .status-value { color: var(--warning); }

        .status-label {
            font-size: 0.75rem;
            color: #6B7280;
        }

        /* Countries List */
        .country-list {
            margin-top: 1rem;
        }

        .country-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.6rem 0;
            border-bottom: 1px solid #F3F4F6;
            transition: var(--transition);
        }

        .country-item:hover {
            background: #F9FAFB;
        }

        .country-item:last-child {
            border-bottom: none;
        }

        .country-name {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .country-flag {
            width: 20px;
            height: 14px;
            border-radius: 2px;
            object-fit: cover;
        }

        .country-percentage {
            font-weight: 600;
            color: var(--primary);
            font-size: 0.85rem;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            border-radius: var(--border-radius);
            margin-top: 1rem;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 800px;
        }

        thead {
            position: sticky;
            top: 0;
            z-index: 1;
        }

        th {
            background: #F9FAFB;
            color: #4B5563;
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 0.8rem 1rem;
            text-align: left;
            border-bottom: 1px solid #E5E7EB;
            cursor: pointer;
        }

        th i {
            margin-left: 5px;
            font-size: 0.7rem;
            color: #9CA3AF;
        }

        td {
            padding: 0.8rem 1rem;
            font-size: 0.85rem;
            border-bottom: 1px solid #F3F4F6;
            background: white;
        }

        tr:hover td {
            background: #F9FAFB;
        }

        .status-badge {
            display: inline-block;
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        /* Status Badge Colors */
        .status-badge.permohonan { background: rgba(59, 130, 246, 0.1); color: var(--info); }
        .status-badge.pemeriksaan { background: rgba(139, 92, 246, 0.1); color: var(--process); }
        .status-badge.persetujuan { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .status-badge.penerimaan { background: rgba(5, 150, 105, 0.1); color: #059669; }
        .status-badge.penerbitan { background: rgba(6, 182, 212, 0.1); color: #06B6D4; }
        .status-badge.penolakan { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .status-badge.pengunggahan { background: rgba(245, 158, 11, 0.1); color: var(--warning); }

        /* Notifications Dropdown */
        .notifications-dropdown {
            position: absolute;
            right: 0;
            top: 50px;
            width: 360px;
            max-width: 90vw;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: none;
            overflow: hidden;
        }

        .notifications-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #F3F4F6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notifications-title {
            font-weight: 600;
            font-size: 1rem;
        }

        .mark-all-read {
            color: var(--primary);
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .mark-all-read:hover {
            opacity: 0.8;
        }

        .notification-item {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #F3F4F6;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .notification-item.read {
            opacity: 0.6;
            background: #F9FAFB;
        }

        .notification-item:hover {
            background: #F3F4F6;
        }

        .notification-company {
            font-weight: 600;
            margin-bottom: 0.3rem;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .notification-time {
            font-size: 0.7rem;
            color: #6B7280;
            margin-bottom: 0.6rem;
        }

        .notification-message {
            font-size: 0.8rem;
            color: #4B5563;
            margin-bottom: 0.8rem;
            line-height: 1.5;
        }

        /* Peta Eksportir */
        #exportersMap, #detailedExportersMap, #analysisGeographicMap {
            height: 350px; /* Default height for maps */
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-top: 1rem;
            z-index: 1;
        }

        /* Adjust map marker size */
        .leaflet-marker-icon {
            width: 25px !important; /* Smaller default marker size */
            height: 41px !important;
            margin-left: -12px !important;
            margin-top: -41px !important;
        }

        .leaflet-circle-marker {
            stroke-width: 1px;
            stroke-opacity: 0.8;
            fill-opacity: 0.7;
        }

        .map-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
            align-items: center;
        }

        .legend-title {
            font-size: 0.8rem;
            color: #6B7280;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        /* Chart Containers */
        .chart-container {
            height: 350px;
            margin-top: 1rem;
            position: relative;
            flex-grow: 1;
        }

        /* Doughnut Container */
        .doughnut-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            align-items: center;
            gap: 1.5rem;
            height: 100%;
        }
        
        .doughnut-chart, .doughnut-info {
            min-width: 0;
        }

        .doughnut-chart {
            height: 100%;
            min-height: 250px;
        }
        
        .doughnut-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .doughnut-total {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .doughnut-label {
            font-size: 1rem;
            color: #6B7280;
            margin-bottom: 1.5rem;
        }
        
        .doughnut-detail-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.8rem;
        }
        
        .doughnut-detail-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            margin-right: 8px;
        }
        
        .doughnut-detail-label {
            flex: 1;
            font-size: 0.85rem;
            color: #4B5563;
        }
        
        .doughnut-detail-value {
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--dark);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .close-modal {
            font-size: 1.5rem;
            cursor: pointer;
            color: #6B7280;
            transition: var(--transition);
        }
        
        .close-modal:hover {
            color: var(--dark);
        }
        
        .modal-body {
            margin-bottom: 1.5rem;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
        }

        /* Bar Chart Race Styles */
        #raceChart {
            height: 350px; /* Adjusted height */
            width: 100%;
            font-family: sans-serif;
            position: relative;
            overflow: visible;
        }
        #raceChart svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }
        .race-bar {
            fill-opacity: 0.7;
            cursor: pointer;
        }
        .race-bar-label {
            font-size: 12px;
            fill: #333;
            text-anchor: end;
            dominant-baseline: middle;
            font-weight: 500;
        }
        .race-axis path, .race-axis line {
            stroke: #ccc;
        }
        .race-axis text {
            font-size: 10px;
            fill: #6B7280;
        }
        .race-date {
            font-size: 2.5em;
            font-weight: bold;
            fill: #ccc;
            text-anchor: end;
        }
        .race-bar-value {
            font-size: 12px;
            fill: white;
            text-anchor: end;
            dominant-baseline: middle;
            font-weight: 600;
            text-shadow: 0px 0px 3px #000000, 0px 0px 3px #000000;
        }

        /* Button Styles */
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 0.6rem 1.2rem;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: #1C3D8C;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Filter Section */
        .filter-section {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: flex-end;
            margin-bottom: 1.5rem; /* Added margin */
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-width: 180px; /* Adjusted min-width */
            flex: 1;
        }

        .filter-group.date-range {
            flex-direction: row;
            align-items: flex-end;
            gap: 0.5rem;
        }

        .filter-group.date-range .filter-input {
            flex: 1;
        }

        .filter-label {
            font-size: 0.8rem;
            font-weight: 500;
            color: #4B5563;
        }

        .filter-select, .filter-input {
            padding: 0.7rem 1rem;
            border: 1px solid #E5E7EB;
            border-radius: var(--border-radius);
            background: white;
            font-size: 0.85rem;
            transition: var(--transition);
            width: 100%; /* Ensure full width within group */
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        /* Info Text */
        .info-text {
            font-size: 0.8rem;
            color: #6B7280;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Map and Country Grid */
        .map-country-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
        }

        /* Detail Modal Specific Styles */
        .detail-modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .detail-modal-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .detail-modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 1.5rem;
        }

        .detail-modal-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            text-align: left;
            margin-bottom: 2rem;
        }

        .detail-modal-info p {
            margin-bottom: 0.5rem;
        }

        .detail-modal-info strong {
            color: var(--dark);
        }

        .detail-modal-status-badge {
            font-size: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: 600;
            display: inline-block;
            margin-top: 1rem;
        }

        /* Analysis Container */
        .analysis-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            padding: 1rem 0;
        }

        .analysis-chart {
            background: white;
            border-radius: var(--border-radius);
            padding: 1rem;
            min-height: 300px;
        }

        .analysis-text {
            background: #F9FAFB;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            font-size: 0.9rem;
            line-height: 1.6;
            border: 1px solid #F3F4F6;
        }

        .analysis-text h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .analysis-text p {
            margin-bottom: 1rem;
        }

        .analysis-text .highlight {
            background-color: rgba(212, 175, 55, 0.2);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-weight: 600;
            color: #a47d07;
        }

        #performanceComparisonChart {
            min-height: 350px;
            width: 100%;
            flex-grow: 1;
        }

        /* KPI Section */
        .kpi-section {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .kpi-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--box-shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .kpi-label {
            font-size: 0.9rem;
            color: #6B7280;
        }

        .kpi-trend {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .kpi-trend.up {
            color: var(--success);
        }

        .kpi-trend.down {
            color: var(--danger);
        }

        /* Verifier Performance */
        .verifier-performance {
            margin-top: 1.5rem;
        }

        .verifier-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-radius: var(--border-radius);
            background: white;
            box-shadow: var(--box-shadow);
            margin-bottom: 1rem;
        }

        .verifier-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 1rem;
        }

        .verifier-info {
            flex: 1;
        }

        .verifier-name {
            font-weight: 600;
            margin-bottom: 0.2rem;
        }

        .verifier-stats {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            color: #6B7280;
        }

        .verifier-stat {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .verifier-stat i {
            font-size: 0.7rem;
        }

        /* Responsive adjustments */
        @media (max-width: 1400px) {
            .dashboard-grid { grid-template-columns: repeat(6, 1fr); }
            .card-lg { grid-column: span 6; }
            .card-md { grid-column: span 3; }
            .card-sm { grid-column: span 2; }
            .map-country-grid { grid-template-columns: 1fr 1fr; }
            .kpi-section { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 992px) {
            .dashboard-grid, .map-country-grid, .analysis-container, .doughnut-container { grid-template-columns: 1fr; }
            .card-lg, .card-md, .card-sm, .card-full { grid-column: span 1; }
            .doughnut-info { padding-left: 0; padding-top: 1rem; width: 100%; }
            .filter-section { flex-direction: column; align-items: stretch; }
            .filter-group { min-width: 100%; }
            .detail-modal-info { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .main-content { padding: 1.5rem; }
            .header { flex-direction: column; align-items: flex-start; gap: 1rem; }
            .header-actions { width: 100%; justify-content: space-between; }
            .search-bar { width: 100%; }
            .status-cards { grid-template-columns: repeat(2, 1fr); }
            .kpi-section { grid-template-columns: 1fr; }
        }

        @media (max-width: 576px) {
            .main-content { padding: 1rem; }
            .user-name, .user-role { display: none; }
            .status-cards { grid-template-columns: 1fr; }
            .chart-container, #exportersMap, #raceChart, #analysisGeographicMap { height: 300px; }
            .modal-content, .detail-modal-content { width: 95%; padding: 1rem; }
        }

        /* Content Display Logic */
        .content-section { display: none; }
        .content-section.active { display: flex; flex-direction: column; gap: 1.5rem; }
        .content-subsection { display: none; }
        .content-subsection.active { display: block; }

        /* Navigation buttons for main sections */
        .main-nav-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .main-nav-buttons .btn {
            flex-grow: 1;
            justify-content: center;
            background: #E5E7EB;
            color: var(--dark);
            border: 1px solid #D1D5DB;
        }

        .main-nav-buttons .btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            border-bottom: 1px solid #E5E7EB;
            margin-bottom: 1.5rem;
        }

        .tab-nav-item {
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            font-weight: 500;
            color: #6B7280;
            border-bottom: 2px solid transparent;
            transition: var(--transition);
        }

        .tab-nav-item.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-nav-item:hover:not(.active) {
            color: var(--dark);
            border-bottom-color: #D1D5DB;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Verifier KPI Table */
        .verifier-kpi-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .verifier-kpi-table th, .verifier-kpi-table td {
            border: 1px solid #E5E7EB;
            padding: 0.8rem;
            text-align: left;
            font-size: 0.85rem;
        }

        .verifier-kpi-table th {
            background-color: #F9FAFB;
            font-weight: 600;
        }

        .verifier-kpi-table tbody tr:nth-child(even) {
            background-color: #F9FAFB;
        }

        .verifier-kpi-table tbody tr:hover {
            background-color: #F3F4F6;
        }

        .verifier-kpi-table .status-badge {
            font-size: 0.65rem;
            padding: 0.2rem 0.5rem;
        }

        /* New styles for detailed status modal */
        .status-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .status-detail-card {
            background: #F9FAFB;
            border-radius: var(--border-radius);
            padding: 1rem;
            text-align: center;
            border: 1px solid #E5E7EB;
        }

        .status-detail-card .status-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
        }

        .status-detail-card .status-label {
            font-size: 0.85rem;
            color: #6B7280;
        }

        .status-detail-card.permohonan { border-bottom: 3px solid var(--info); }
        .status-detail-card.pemeriksaan { border-bottom: 3px solid var(--process); }
        .status-detail-card.persetujuan { border-bottom: 3px solid var(--success); }
        .status-detail-card.penerimaan { border-bottom: 3px solid #059669; }
        .status-detail-card.penerbitan { border-bottom: 3px solid #06B6D4; }
        .status-detail-card.penolakan { border-bottom: 3px solid var(--danger); }
        .status-detail-card.pengunggahan { border-bottom: 3px solid var(--warning); }

        /* Application Detail Modal - Tabs */
        .app-detail-tabs {
            display: flex;
            border-bottom: 1px solid #E5E7EB;
            margin-bottom: 1rem;
        }

        .app-detail-tab-item {
            padding: 0.6rem 1rem;
            cursor: pointer;
            font-weight: 500;
            color: #6B7280;
            border-bottom: 2px solid transparent;
            transition: var(--transition);
        }

        .app-detail-tab-item.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .app-detail-tab-content {
            display: none;
            padding-top: 1rem;
        }

        .app-detail-tab-content.active {
            display: block;
        }

        .app-detail-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .app-detail-info-grid p {
            margin-bottom: 0.5rem;
        }

        .app-detail-info-grid strong {
            color: var(--dark);
        }

        .audit-log-item {
            background: #F9FAFB;
            border-radius: var(--border-radius);
            padding: 0.8rem 1rem;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
            border: 1px solid #E5E7EB;
        }

        .audit-log-item strong {
            color: var(--primary);
        }

        .audit-log-item span {
            color: #6B7280;
        }

        /* Document List in Detail Modal */
        .document-list {
            list-style: none;
            padding: 0;
        }

        .document-list li {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #F9FAFB;
            padding: 0.8rem 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 0.5rem;
            border: 1px solid #E5E7EB;
        }

        .document-list li a {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
        }

        .document-list li a:hover {
            color: var(--primary);
        }

        .document-list li .doc-icon {
            font-size: 1.2rem;
            color: var(--primary-light);
        }

        .document-list li .doc-status {
            font-size: 0.75rem;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-weight: 600;
        }

        .document-list li .doc-status.valid { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .document-list li .doc-status.pending { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .document-list li .doc-status.rejected { background: rgba(239, 68, 68, 0.1); color: var(--danger); }


        /* New Analysis Sections */
        .analysis-section-card {
            grid-column: 1 / -1; /* Full width */
        }

        .analysis-section-card .card-body {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .analysis-section-card .chart-container {
            margin-top: 0; /* Remove extra margin */
        }

        .analysis-section-card .info-text {
            margin-top: 0;
        }

        .analysis-section-card .table-container {
            margin-top: 0;
        }

        .analysis-section-card .analysis-text {
            margin-top: 0;
        }

        /* Specific styles for geographic analysis map */
        #analysisGeographicMap {
            height: 400px;
        }

        .geographic-info-modal-content {
            max-width: 900px; /* Wider for map and info */
        }

        .geographic-info-modal-content .modal-body {
            display: grid;
            grid-template-columns: 2fr 1fr; /* Map on left, info on right */
            gap: 1.5rem;
            text-align: left;
        }

        .geographic-info-panel {
            background: #F9FAFB;
            border-radius: var(--border-radius);
            padding: 1rem;
            border: 1px solid #E5E7EB;
            max-height: 400px; /* Limit height to match map */
            overflow-y: auto;
        }

        .geographic-info-panel h4 {
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 0.8rem;
        }

        .geographic-info-panel p {
            margin-bottom: 0.5rem;
        }

        .geographic-info-panel ul {
            list-style: none;
            padding: 0;
            margin-top: 0.5rem;
        }

        .geographic-info-panel ul li {
            background: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin-bottom: 0.3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #F3F4F6;
        }

        .geographic-info-panel ul li span:first-child {
            font-weight: 500;
        }

        .geographic-info-panel ul li span:last-child {
            font-weight: 600;
            color: var(--primary);
        }

        /* Verifier Personal Dashboard */
        .personal-kpi-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .personal-kpi-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--box-shadow);
            text-align: center;
        }

        .personal-kpi-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .personal-kpi-label {
            font-size: 0.9rem;
            color: #6B7280;
        }

        .personal-task-list {
            margin-top: 1.5rem;
        }

        .personal-task-item {
            background: white;
            border-radius: var(--border-radius);
            padding: 1rem;
            box-shadow: var(--box-shadow);
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .personal-task-info {
            flex: 1;
        }

        .personal-task-info h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .personal-task-info p {
            font-size: 0.85rem;
            color: #6B7280;
        }

        .personal-task-actions .btn {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Laporan Kustom */
        .report-options {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .report-options .filter-group {
            flex: 1;
            min-width: 150px;
        }

        .report-preview {
            background: #F9FAFB;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            color: #4B5563;
            font-size: 0.9rem;
            line-height: 1.6;
            border: 1px solid #E5E7EB;
            overflow-x: auto;
        }

        .report-preview h4 {
            color: var(--primary);
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }

        .report-preview ul {
            list-style: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .report-preview p {
            margin-bottom: 0.8rem;
        }

        .report-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        /* Full Applications Table Modal */
        #allApplicationsModal .modal-content {
            max-width: 1200px;
        }

        #allApplicationsModal .filter-section {
            box-shadow: none;
            padding: 0;
            margin-bottom: 1rem;
        }

        #allApplicationsModal .table-container {
            max-height: 60vh; /* Limit height for scrollability */
        }

        #allApplicationsModal .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .pagination button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .pagination button:hover:not(:disabled) {
            background: #1C3D8C;
        }

        .pagination button:disabled {
            background: #E5E7EB;
            color: #9CA3AF;
            cursor: not-allowed;
        }

        .pagination span {
            font-weight: 500;
            color: var(--dark);
        }

    </style>
</head>
<body>
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <div class="page-title">
                <h1>Dashboard IPSKA</h1>
                <p>Verifikasi dan Validasi Dokumen SKA</p>
            </div>
            <div class="header-actions">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Cari perusahaan, komoditas...">
                </div>
                <div class="user-actions">
                    <div class="notification-bell">
                        <i class="fas fa-bell"></i>
                        <div class="notification-badge">3</div>
                        <div class="notifications-dropdown">
                            <div class="notifications-header">
                                <div class="notifications-title">Notifikasi</div>
                                <div class="mark-all-read" onclick="markAllNotificationsRead()">Tandai semua terbaca</div>
                            </div>
                            <div class="notification-list">
                                <div class="notification-item" data-status="success">
                                    <div class="notification-company">
                                        <span>PT. Maju Jaya Abadi</span>
                                        <i class="fas fa-circle" style="color: var(--success); font-size: 0.5rem;" title="Disetujui"></i>
                                    </div>
                                    <div class="notification-time">2 jam yang lalu</div>
                                    <div class="notification-message">Pengajuan SKA untuk komoditas Kopi telah diverifikasi dan disetujui</div>
                                </div>
                                <div class="notification-item" data-status="danger">
                                    <div class="notification-company">
                                        <span>CV. Sejahtera Bersama</span>
                                        <i class="fas fa-circle" style="color: var(--danger); font-size: 0.5rem;" title="Ditolak"></i>
                                    </div>
                                    <div class="notification-time">5 jam yang lalu</div>
                                    <div class="notification-message">Pengajuan SKA untuk komoditas Karet ditolak karena dokumen tidak lengkap</div>
                                </div>
                                <div class="notification-item" data-status="info">
                                    <div class="notification-company">
                                        <span>PT. Makmur Sentosa</span>
                                        <i class="fas fa-circle" style="color: var(--info); font-size: 0.5rem;" title="Pengajuan Baru"></i>
                                    </div>
                                    <div class="notification-time">Kemarin</div>
                                    <div class="notification-message">Pengajuan baru untuk komoditas Kelapa Sawit</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="user-profile">
                        <div class="user-avatar">AD</div>
                        <div class="user-details">
                            <div class="user-name">Admin IPSKA</div>
                            <div class="user-role">Verifikator</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Global Filter Section -->
        <div class="filter-section">
            <div class="filter-group">
                <label for="filter-period" class="filter-label">Periode Waktu</label>
                <select id="filter-period" class="filter-select" onchange="toggleCustomDateInputs()">
                    <option value="all">Semua</option>
                    <option value="today">Hari Ini</option>
                    <option value="week">Minggu Ini</option>
                    <option value="month">Bulan Ini</option>
                    <option value="quarter">Kuartal Ini</option>
                    <option value="year">Tahun Ini</option>
                    <option value="custom">Kustom</option>
                </select>
            </div>
            <div class="filter-group date-range" id="custom-date-range" style="display: none;">
                <label for="filter-start-date" class="filter-label">Dari</label>
                <input type="date" id="filter-start-date" class="filter-input">
                <label for="filter-end-date" class="filter-label">Sampai</label>
                <input type="date" id="filter-end-date" class="filter-input">
            </div>
            <div class="filter-group">
                <label for="filter-status" class="filter-label">Status Pengajuan</label>
                <select id="filter-status" class="filter-select">
                    <option value="all">Semua Status</option>
                    <option value="permohonan">Permohonan</option>
                    <option value="pemeriksaan">Pemeriksaan</option>
                    <option value="persetujuan">Persetujuan</option>
                    <option value="penerimaan">Penerimaan</option>
                    <option value="penerbitan">Penerbitan</option>
                    <option value="penolakan">Penolakan</option>
                    <option value="pengunggahan">Pengunggahan</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-commodity" class="filter-label">Komoditas</label>
                <select id="filter-commodity" class="filter-select">
                    <option value="all">Semua Komoditas</option>
                    <option value="kopi">Kopi</option>
                    <option value="karet">Karet</option>
                    <option value="kelapa_sawit">Kelapa Sawit</option>
                    <option value="kakao">Kakao</option>
                    <option value="teh">Teh</option>
                    <option value="lainnya">Lainnya</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-country" class="filter-label">Negara Tujuan</label>
                <select id="filter-country" class="filter-select">
                    <option value="all">Semua Negara</option>
                    <option value="usa">Amerika Serikat</option>
                    <option value="japan">Jepang</option>
                    <option value="china">Tiongkok</option>
                    <option value="germany">Jerman</option>
                    <option value="netherlands">Belanda</option>
                    <option value="india">India</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filter-verifier" class="filter-label">Verifikator</label>
                <select id="filter-verifier" class="filter-select">
                    <option value="all">Semua Verifikator</option>
                    <option value="ahmad">Ahmad Santoso</option>
                    <option value="budi">Budi Darmawan</option>
                    <option value="citra">Citra Wijaya</option>
                </select>
            </div>
            <div class="filter-group" style="flex-grow: 0;">
                <button class="btn"><i class="fas fa-filter"></i> Terapkan Filter</button>
            </div>
        </div>

        <!-- KPI Section -->
        <div class="kpi-section">
            <div class="kpi-card">
                <div class="kpi-value">1,248</div>
                <div class="kpi-label">Total Pengajuan</div>
                <div class="kpi-trend up">
                    <i class="fas fa-arrow-up"></i> 12% dari bulan lalu
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-value">942</div>
                <div class="kpi-label">Terverifikasi</div>
                <div class="kpi-trend up">
                    <i class="fas fa-arrow-up"></i> 8% dari bulan lalu
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-value">1.2</div>
                <div class="kpi-label">Rata-rata Hari</div>
                <div class="kpi-trend down">
                    <i class="fas fa-arrow-down"></i> 0.3 dari bulan lalu
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-value">87%</div>
                <div class="kpi-label">Tingkat Penyelesaian</div>
                <div class="kpi-trend up">
                    <i class="fas fa-arrow-up"></i> 5% dari bulan lalu
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <div class="tab-nav-item active" data-tab="overview">Gambaran Umum</div>
            <div class="tab-nav-item" data-tab="performance">Kinerja Verifikator</div>
            <div class="tab-nav-item" data-tab="analysis">Analisis Data</div>
            <div class="tab-nav-item" data-tab="personal">Dashboard Saya</div>
            <div class="tab-nav-item" data-tab="reports">Laporan Kustom</div>
        </div>

        <!-- Overview Tab -->
        <div class="tab-content active" id="overview">
            <!-- Status Pengajuan -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Status Pengajuan SKA</div>
                    <div class="card-actions">
                        <button class="btn" onclick="showDetailModal('status')">
                            <i class="fas fa-search"></i> Detail
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress">
                                <div class="progress-segment permohonan" style="width: 20%"></div>
                                <div class="progress-segment pemeriksaan" style="width: 25%"></div>
                                <div class="progress-segment persetujuan" style="width: 20%"></div>
                                <div class="progress-segment penerimaan" style="width: 10%"></div>
                                <div class="progress-segment penerbitan" style="width: 15%"></div>
                                <div class="progress-segment penolakan" style="width: 5%"></div>
                                <div class="progress-segment pengunggahan" style="width: 5%"></div>
                            </div>
                        </div>
                        <div class="progress-labels">
                            <span>Permohonan (20%)</span>
                            <span>Pemeriksaan (25%)</span>
                            <span>Persetujuan (20%)</span>
                            <span>Penerimaan (10%)</span>
                            <span>Penerbitan (15%)</span>
                            <span>Penolakan (5%)</span>
                            <span>Pengunggahan (5%)</span>
                        </div>
                    </div>
                    <div class="status-cards">
                        <div class="status-card permohonan">
                            <div class="status-value">250</div>
                            <div class="status-label">Permohonan</div>
                        </div>
                        <div class="status-card pemeriksaan">
                            <div class="status-value">312</div>
                            <div class="status-label">Pemeriksaan</div>
                        </div>
                        <div class="status-card persetujuan">
                            <div class="status-value">250</div>
                            <div class="status-label">Persetujuan</div>
                        </div>
                        <div class="status-card penerimaan">
                            <div class="status-value">125</div>
                            <div class="status-label">Penerimaan</div>
                        </div>
                        <div class="status-card penerbitan">
                            <div class="status-value">187</div>
                            <div class="status-label">Penerbitan</div>
                        </div>
                        <div class="status-card penolakan">
                            <div class="status-value">62</div>
                            <div class="status-label">Penolakan</div>
                        </div>
                        <div class="status-card pengunggahan">
                            <div class="status-value">62</div>
                            <div class="status-label">Pengunggahan</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Map and Top Countries -->
            <div class="dashboard-grid">
                <div class="card card-lg">
                    <div class="card-header">
                        <div class="card-title">Distribusi Eksportir</div>
                        <div class="card-actions">
                            <button class="btn" onclick="showDetailModal('map')">
                                <i class="fas fa-search"></i> Detail
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="exportersMap"></div>
                        <div class="map-legend">
                            <div class="legend-title">Legenda:</div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: var(--primary);"></div>
                                <span>100+ eksportir</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: var(--primary-light);"></div>
                                <span>50-99 eksportir</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #93C5FD;"></div>
                                <span>10-49 eksportir</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color" style="background: #BFDBFE;"></div>
                                <span>1-9 eksportir</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card card-md">
                    <div class="card-header">
                        <div class="card-title">Negara Tujuan Teratas</div>
                        <div class="card-actions">
                            <!-- Removed detail button as it's integrated into map detail -->
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="country-list">
                            <div class="country-item">
                                <div class="country-name">
                                    <img src="https://flagcdn.com/us.svg" class="country-flag" alt="USA">
                                    <span>Amerika Serikat</span>
                                </div>
                                <div class="country-percentage">32%</div>
                            </div>
                            <div class="country-item">
                                <div class="country-name">
                                    <img src="https://flagcdn.com/jp.svg" class="country-flag" alt="Japan">
                                    <span>Jepang</span>
                                </div>
                                <div class="country-percentage">18%</div>
                            </div>
                            <div class="country-item">
                                <div class="country-name">
                                    <img src="https://flagcdn.com/cn.svg" class="country-flag" alt="China">
                                    <span>Tiongkok</span>
                                </div>
                                <div class="country-percentage">15%</div>
                            </div>
                            <div class="country-item">
                                <div class="country-name">
                                    <img src="https://flagcdn.com/de.svg" class="country-flag" alt="Germany">
                                    <span>Jerman</span>
                                </div>
                                <div class="country-percentage">9%</div>
                            </div>
                            <div class="country-item">
                                <div class="country-name">
                                    <img src="https://flagcdn.com/nl.svg" class="country-flag" alt="Netherlands">
                                    <span>Belanda</span>
                                </div>
                                <div class="country-percentage">7%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Commodity Distribution (Bar Chart Race) -->
            <div class="card card-full">
                <div class="card-header">
                    <div class="card-title">Distribusi Komoditas (Tren)</div>
                    <div class="card-actions">
                        <button class="btn" onclick="showDetailModal('commodities')">
                            <i class="fas fa-search"></i> Detail
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="filter-section" style="box-shadow: none; padding: 0; margin-bottom: 1rem;">
                        <div class="filter-group">
                            <label for="race-chart-period" class="filter-label">Periode</label>
                            <select id="race-chart-period" class="filter-select" onchange="updateRaceChartPeriod()">
                                <option value="monthly">Bulanan</option>
                                <option value="quarterly">Kuartalan</option>
                                <option value="yearly">Tahunan</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="race-chart-top-n" class="filter-label">Top N Komoditas</label>
                            <select id="race-chart-top-n" class="filter-select" onchange="updateRaceChartPeriod()">
                                <option value="5">Top 5</option>
                                <option value="10">Top 10</option>
                                <option value="all">Semua</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div id="raceChart"></div>
                    </div>
                </div>
            </div>

            <!-- Recent Applications -->
            <div class="card card-full">
                <div class="card-header">
                    <div class="card-title">Pengajuan Terbaru</div>
                    <div class="card-actions">
                        <button class="btn" onclick="showDetailModal('allApplications')">
                            <i class="fas fa-list"></i> Lihat Semua
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table id="recentApplicationsTable">
                            <thead>
                                <tr>
                                    <th>No. Pengajuan <i class="fas fa-sort"></i></th>
                                    <th>Perusahaan <i class="fas fa-sort"></i></th>
                                    <th>Komoditas <i class="fas fa-sort"></i></th>
                                    <th>Negara Tujuan <i class="fas fa-sort"></i></th>
                                    <th>Tanggal <i class="fas fa-sort"></i></th>
                                    <th>Status <i class="fas fa-sort"></i></th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Tab -->
        <div class="tab-content" id="performance">
            <div class="card card-full">
                <div class="card-header">
                    <div class="card-title">Kinerja Verifikator</div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <div id="verifierPerformanceChart"></div>
                    </div>
                </div>
            </div>

            <div class="card card-full">
                <div class="card-header">
                    <div class="card-title">Detail Kinerja</div>
                </div>
                <div class="card-body">
                    <div class="verifier-performance">
                        <div class="verifier-item">
                            <div class="verifier-avatar">AS</div>
                            <div class="verifier-info">
                                <div class="verifier-name">Ahmad Santoso</div>
                                <div class="verifier-stats">
                                    <div class="verifier-stat">
                                        <i class="fas fa-check-circle" style="color: var(--success);"></i>
                                        <span>128 verifikasi</span>
                                    </div>
                                    <div class="verifier-stat">
                                        <i class="fas fa-clock" style="color: var(--warning);"></i>
                                        <span>1.1 hari rata-rata</span>
                                    </div>
                                    <div class="verifier-stat">
                                        <i class="fas fa-percentage" style="color: var(--info);"></i>
                                        <span>92% penyelesaian</span>
                                    </div>
                                </div>
                            </div>
                            <button class="btn" onclick="showVerifierDetail('AS')">Detail</button>
                        </div>
                        <div class="verifier-item">
                            <div class="verifier-avatar">BD</div>
                            <div class="verifier-info">
                                <div class="verifier-name">Budi Darmawan</div>
                                <div class="verifier-stats">
                                    <div class="verifier-stat">
                                        <i class="fas fa-check-circle" style="color: var(--success);"></i>
                                        <span>112 verifikasi</span>
                                    </div>
                                    <div class="verifier-stat">
                                        <i class="fas fa-clock" style="color: var(--warning);"></i>
                                        <span>1.4 hari rata-rata</span>
                                    </div>
                                    <div class="verifier-stat">
                                        <i class="fas fa-percentage" style="color: var(--info);"></i>
                                        <span>88% penyelesaian</span>
                                    </div>
                                </div>
                            </div>
                            <button class="btn" onclick="showVerifierDetail('BD')">Detail</button>
                        </div>
                        <div class="verifier-item">
                            <div class="verifier-avatar">CW</div>
                            <div class="verifier-info">
                                <div class="verifier-name">Citra Wijaya</div>
                                <div class="verifier-stats">
                                    <div class="verifier-stat">
                                        <i class="fas fa-check-circle" style="color: var(--success);"></i>
                                        <span>98 verifikasi</span>
                                    </div>
                                    <div class="verifier-stat">
                                        <i class="fas fa-clock" style="color: var(--warning);"></i>
                                        <span>1.3 hari rata-rata</span>
                                    </div>
                                    <div class="verifier-stat">
                                        <i class="fas fa-percentage" style="color: var(--info);"></i>
                                        <span>90% penyelesaian</span>
                                    </div>
                                </div>
                            </div>
                            <button class="btn" onclick="showVerifierDetail('CW')">Detail</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Tab -->
        <div class="tab-content" id="analysis">
            <div class="card analysis-section-card">
                <div class="card-header">
                    <div class="card-title">Tren Pengajuan SKA</div>
                </div>
                <div class="card-body">
                    <div class="filter-section" style="box-shadow: none; padding: 0; margin-bottom: 1rem;">
                        <div class="filter-group">
                            <label for="trend-chart-period" class="filter-label">Periode</label>
                            <select id="trend-chart-period" class="filter-select" onchange="initTrendChart()">
                                <option value="monthly">Bulanan</option>
                                <option value="quarterly">Kuartalan</option>
                                <option value="yearly">Tahunan</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div id="trendChart"></div>
                    </div>
                    <div class="analysis-text">
                        <h3>Analisis Tren Pengajuan</h3>
                        <p>Grafik di atas menunjukkan tren jumlah pengajuan SKA secara keseluruhan dan yang berhasil disetujui dari waktu ke waktu. Perhatikan pola musiman atau dampak dari kebijakan tertentu.</p>
                        <p>Terdapat peningkatan <span class="highlight">12%</span> dalam jumlah pengajuan SKA pada bulan Mei 2023 dibandingkan bulan sebelumnya, menunjukkan pertumbuhan aktivitas ekspor.</p>
                    </div>
                </div>
            </div>

            <div class="card analysis-section-card">
                <div class="card-header">
                    <div class="card-title">Performa Komoditas</div>
                </div>
                <div class="card-body">
                    <div class="filter-section" style="box-shadow: none; padding: 0; margin-bottom: 1rem;">
                        <div class="filter-group">
                            <label for="commodity-perf-period" class="filter-label">Periode</label>
                            <select id="commodity-perf-period" class="filter-select" onchange="initCommodityPerformanceChart()">
                                <option value="monthly">Bulanan</option>
                                <option value="quarterly">Kuartalan</option>
                                <option value="yearly">Tahunan</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="commodity-perf-top-n" class="filter-label">Top N</label>
                            <select id="commodity-perf-top-n" class="filter-select" onchange="initCommodityPerformanceChart()">
                                <option value="5">Top 5</option>
                                <option value="10">Top 10</option>
                                <option value="all">Semua</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div id="commodityPerformanceChart"></div>
                    </div>
                    <div class="analysis-text">
                        <h3>Analisis Performa Komoditas</h3>
                        <p>Bagian ini menganalisis komoditas mana yang paling sering diajukan dan bagaimana tingkat keberhasilannya. Identifikasi komoditas unggulan atau yang memerlukan perhatian khusus.</p>
                        <p>Komoditas dengan pengajuan terbanyak adalah <span class="highlight">Kopi (28%)</span>, diikuti oleh <span class="highlight">Karet (22%)</span> dan <span class="highlight">Kelapa Sawit (18%)</span>. Tingkat persetujuan untuk Kopi mencapai 95%.</p>
                    </div>
                </div>
            </div>

            <div class="card analysis-section-card">
                <div class="card-header">
                    <div class="card-title">Efisiensi Proses Verifikasi</div>
                </div>
                <div class="card-body">
                    <div class="filter-section" style="box-shadow: none; padding: 0; margin-bottom: 1rem;">
                        <div class="filter-group">
                            <label for="efficiency-period" class="filter-label">Periode</label>
                            <select id="efficiency-period" class="filter-select" onchange="initVerificationEfficiencyChart()">
                                <option value="monthly">Bulanan</option>
                                <option value="quarterly">Kuartalan</option>
                                <option value="yearly">Tahunan</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div id="verificationEfficiencyChart"></div>
                    </div>
                    <div class="analysis-text">
                        <h3>Analisis Efisiensi Proses</h3>
                        <p>Grafik ini menunjukkan rata-rata waktu yang dibutuhkan untuk setiap tahapan verifikasi. Waktu rata-rata verifikasi mengalami penurunan dari <span class="highlight">1.5 hari</span> menjadi <span class="highlight">1.2 hari</span>, menunjukkan peningkatan efisiensi proses verifikasi.</p>
                        <p>Target waktu penyelesaian untuk tahap pemeriksaan adalah 1 hari. Saat ini, rata-rata waktu pemeriksaan adalah 1.5 hari, menunjukkan area yang perlu ditingkatkan.</p>
                    </div>
                </div>
            </div>

            <div class="card analysis-section-card">
                <div class="card-header">
                    <div class="card-title">Kepatuhan Eksportir</div>
                </div>
                <div class="card-body">
                    <div class="filter-section" style="box-shadow: none; padding: 0; margin-bottom: 1rem;">
                        <div class="filter-group">
                            <label for="compliance-period" class="filter-label">Periode</label>
                            <select id="compliance-period" class="filter-select" onchange="initExporterComplianceChart()">
                                <option value="monthly">Bulanan</option>
                                <option value="quarterly">Kuartalan</option>
                                <option value="yearly">Tahunan</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div id="exporterComplianceChart"></div>
                    </div>
                    <div class="analysis-text">
                        <h3>Analisis Kepatuhan Eksportir</h3>
                        <p>Menganalisis alasan penolakan pengajuan dan tingkat kelengkapan dokumen. Informasi ini dapat digunakan untuk memberikan edukasi kepada eksportir.</p>
                        <p>Alasan penolakan terbanyak adalah <span class="highlight">dokumen tidak lengkap (45%)</span> dan <span class="highlight">data tidak sesuai (30%)</span>. Tingkat kelengkapan dokumen rata-rata adalah 85%.</p>
                    </div>
                </div>
            </div>

            <div class="card analysis-section-card">
                <div class="card-header">
                    <div class="card-title">Dampak Kebijakan</div>
                </div>
                <div class="card-body">
                    <div class="filter-section" style="box-shadow: none; padding: 0; margin-bottom: 1rem;">
                        <div class="filter-group">
                            <label for="policy-period" class="filter-label">Periode</label>
                            <select id="policy-period" class="filter-select" onchange="initPolicyImpactChart()">
                                <option value="monthly">Bulanan</option>
                                <option value="quarterly">Kuartalan</option>
                                <option value="yearly">Tahunan</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div id="policyImpactChart"></div>
                    </div>
                    <div class="analysis-text">
                        <h3>Analisis Dampak Kebijakan</h3>
                        <p>Melihat bagaimana perubahan kebijakan atau regulasi mempengaruhi jumlah dan jenis pengajuan SKA. Ini membantu dalam evaluasi efektivitas kebijakan.</p>
                        <p>Setelah implementasi kebijakan baru pada Januari 2023, terjadi peningkatan pengajuan sebesar <span class="highlight">15%</span> untuk komoditas tertentu, menunjukkan dampak positif kebijakan tersebut.</p>
                    </div>
                </div>
            </div>

            <div class="card analysis-section-card">
                <div class="card-header">
                    <div class="card-title">Analisis Geografis</div>
                    <div class="card-actions">
                        <button class="btn" onclick="showDetailModal('geographicAnalysis')">
                            <i class="fas fa-search"></i> Detail
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="analysisGeographicMap"></div>
                    <div class="analysis-text">
                        <h3>Distribusi Geografis Pengajuan</h3>
                        <p>Peta ini menunjukkan distribusi pengajuan SKA berdasarkan lokasi eksportir atau negara tujuan. Identifikasi wilayah dengan aktivitas ekspor tinggi atau rendah.</p>
                        <p>Provinsi <span class="highlight">Jawa Barat</span> dan <span class="highlight">Jawa Timur</span> memiliki jumlah eksportir dan pengajuan SKA tertinggi. Amerika Serikat dan Jepang tetap menjadi negara tujuan utama.</p>
                    </div>
                </div>
            </div>

            <div class="card analysis-section-card">
                <div class="card-header">
                    <div class="card-title">Komparasi Performa</div>
                </div>
                <div class="card-body">
                    <div class="filter-section" style="box-shadow: none; padding: 0; margin-bottom: 1rem;">
                        <div class="filter-group">
                            <label for="comparison-period" class="filter-label">Periode</label>
                            <select id="comparison-period" class="filter-select" onchange="initPerformanceComparisonChart()">
                                <option value="monthly">Bulanan</option>
                                <option value="quarterly">Kuartalan</option>
                                <option value="yearly">Tahunan</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div id="performanceComparisonChart"></div>
                    </div>
                    <div class="analysis-text">
                        <h3>Perbandingan Kinerja Verifikator</h3>
                        <p>Membandingkan kinerja antar verifikator dalam hal jumlah verifikasi, rata-rata waktu penyelesaian, dan tingkat penyelesaian. Ini membantu dalam identifikasi best practice dan area pengembangan.</p>
                        <p>Verifikator Ahmad Santoso memiliki rata-rata waktu verifikasi tercepat (1.1 hari) dengan tingkat penyelesaian 92%, menjadikannya salah satu verifikator dengan performa terbaik.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Personal Dashboard Tab -->
        <div class="tab-content" id="personal">
            <div class="card card-full">
                <div class="card-header">
                    <div class="card-title">Ringkasan Kinerja Saya</div>
                </div>
                <div class="card-body">
                    <div class="personal-kpi-section">
                        <div class="personal-kpi-card">
                            <div class="personal-kpi-value">128</div>
                            <div class="personal-kpi-label">Total Verifikasi Bulan Ini</div>
                        </div>
                        <div class="personal-kpi-card">
                            <div class="personal-kpi-value">1.1</div>
                            <div class="personal-kpi-label">Rata-rata Hari Verifikasi</div>
                        </div>
                        <div class="personal-kpi-card">
                            <div class="personal-kpi-value">92%</div>
                            <div class="personal-kpi-label">Tingkat Penyelesaian</div>
                        </div>
                        <div class="personal-kpi-card">
                            <div class="personal-kpi-value">4.8</div>
                            <div class="personal-kpi-label">Rating Kepuasan</div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div id="myPerformanceChart"></div>
                    </div>
                </div>
            </div>

            <div class="card card-full">
                <div class="card-header">
                    <div class="card-title">Tugas Verifikasi Saya</div>
                </div>
                <div class="card-body">
                    <div class="personal-task-list">
                        <div class="personal-task-item">
                            <div class="personal-task-info">
                                <h4>SK-2023-00456 - PT. Makmur Sejahtera (Kopi)</h4>
                                <p>Status: Pemeriksaan | Batas Waktu: 15 Mei 2023</p>
                            </div>
                            <div class="personal-task-actions">
                                <button class="btn" onclick="showApplicationDetail('SK-2023-00456')">Tinjau</button>
                            </div>
                        </div>
                        <div class="personal-task-item">
                            <div class="personal-task-info">
                                <h4>SK-2023-00457 - CV. Abadi Sentosa (Karet)</h4>
                                <p>Status: Permohonan Baru | Batas Waktu: 16 Mei 2023</p>
                            </div>
                            <div class="personal-task-actions">
                                <button class="btn" onclick="showApplicationDetail('SK-2023-00457')">Tinjau</button>
                            </div>
                        </div>
                        <div class="personal-task-item">
                            <div class="personal-task-info">
                                <h4>SK-2023-00458 - UD. Maju Bersama (Kakao)</h4>
                                <p>Status: Pemeriksaan (Revisi) | Batas Waktu: 14 Mei 2023</p>
                            </div>
                            <div class="personal-task-actions">
                                <button class="btn" onclick="showApplicationDetail('SK-2023-00458')">Tinjau</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Custom Reports Tab -->
        <div class="tab-content" id="reports">
            <div class="card card-full">
                <div class="card-header">
                    <div class="card-title">Buat Laporan Kustom</div>
                </div>
                <div class="card-body">
                    <div class="report-options">
                        <div class="filter-group">
                            <label for="report-type" class="filter-label">Jenis Laporan</label>
                            <select id="report-type" class="filter-select">
                                <option value="status_summary">Ringkasan Status</option>
                                <option value="commodity_breakdown">Rincian Komoditas</option>
                                <option value="verifier_performance">Kinerja Verifikator</option>
                                <option value="rejected_applications">Pengajuan Ditolak</option>
                            </option>
                        </select>
                        </div>
                        <div class="filter-group">
                            <label for="report-start-date" class="filter-label">Tanggal Mulai</label>
                            <input type="date" id="report-start-date" class="filter-input">
                        </div>
                        <div class="filter-group">
                            <label for="report-end-date" class="filter-label">Tanggal Akhir</label>
                            <input type="date" id="report-end-date" class="filter-input">
                        </div>
                        <div class="filter-group" style="flex-grow: 0;">
                            <button class="btn" onclick="generateReport()"><i class="fas fa-file-alt"></i> Buat Laporan</button>
                        </div>
                    </div>
                    <div class="report-preview" id="reportPreview">
                        <h4>Panduan Laporan Kustom:</h4>
                        <p>Pilih <b>Jenis Laporan</b> yang Anda inginkan dan tentukan <b>Rentang Tanggal</b>. Klik "Buat Laporan" untuk melihat pratinjau di sini.</p>
                        <ul>
                            <li><b>Ringkasan Status:</b> Menampilkan jumlah pengajuan berdasarkan status (Permohonan, Pemeriksaan, dll.) dalam periode yang dipilih.</li>
                            <li><b>Rincian Komoditas:</b> Menampilkan jumlah pengajuan untuk setiap jenis komoditas.</li>
                            <li><b>Kinerja Verifikator:</b> Merangkum jumlah verifikasi, persetujuan, dan penolakan per verifikator.</li>
                            <li><b>Pengajuan Ditolak:</b> Daftar detail pengajuan yang ditolak dalam rentang tanggal.</li>
                        </ul>
                        <p>Setelah pratinjau muncul, Anda dapat mengunduh laporan dalam format teks.</p>
                    </div>
                    <div class="report-actions">
                        <button class="btn" id="downloadReportBtn" style="display: none;"><i class="fas fa-download"></i> Unduh Laporan</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modals -->
    <div id="statusDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Detail Status Pengajuan</div>
                <div class="close-modal" onclick="closeModal('statusDetailModal')">&times;</div>
            </div>
            <div class="modal-body">
                <div class="chart-container" style="height: 250px;">
                    <div id="statusDetailChart"></div>
                </div>
                <div class="status-detail-grid">
                    <div class="status-detail-card permohonan">
                        <div class="status-value">250</div>
                        <div class="status-label">Permohonan</div>
                    </div>
                    <div class="status-detail-card pemeriksaan">
                        <div class="status-value">312</div>
                        <div class="status-label">Pemeriksaan</div>
                    </div>
                    <div class="status-detail-card persetujuan">
                        <div class="status-value">250</div>
                        <div class="status-label">Persetujuan</div>
                    </div>
                    <div class="status-detail-card penerimaan">
                        <div class="status-value">125</div>
                        <div class="status-label">Penerimaan</div>
                    </div>
                    <div class="status-detail-card penerbitan">
                        <div class="status-value">187</div>
                        <div class="status-label">Penerbitan</div>
                    </div>
                    <div class="status-detail-card penolakan">
                        <div class="status-value">62</div>
                        <div class="status-label">Penolakan</div>
                    </div>
                    <div class="status-detail-card pengunggahan">
                        <div class="status-value">62</div>
                        <div class="status-label">Pengunggahan</div>
                    </div>
                </div>
                <div class="table-container">
                    <table class="verifier-kpi-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Jumlah</th>
                                <th>Persentase</th>
                                <th>Rata-rata Waktu</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="status-badge permohonan">Permohonan</span></td>
                                <td>250</td>
                                <td>20%</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge pemeriksaan">Pemeriksaan</span></td>
                                <td>312</td>
                                <td>25%</td>
                                <td>1.5 hari</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge persetujuan">Persetujuan</span></td>
                                <td>250</td>
                                <td>20%</td>
                                <td>0.5 hari</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge penerimaan">Penerimaan</span></td>
                                <td>125</td>
                                <td>10%</td>
                                <td>0.2 hari</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge penerbitan">Penerbitan</span></td>
                                <td>187</td>
                                <td>15%</td>
                                <td>0.3 hari</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge penolakan">Penolakan</td>
                                <td>62</td>
                                <td>5%</td>
                                <td>1.2 hari</td>
                            </tr>
                            <tr>
                                <td><span class="status-badge pengunggahan">Pengunggahan</td>
                                <td>62</td>
                                <td>5%</td>
                                <td>0.1 hari</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('statusDetailModal')">Tutup</button>
            </div>
        </div>
    </div>

    <div id="mapDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Detail Distribusi Eksportir & Negara Tujuan</div>
                <div class="close-modal" onclick="closeModal('mapDetailModal')">&times;</div>
            </div>
            <div class="modal-body">
                <div class="map-country-grid">
                    <div>
                        <div id="detailedExportersMap" style="height: 400px;"></div>
                    </div>
                    <div>
                        <div class="card-title">Negara Tujuan Teratas</div>
                        <div class="country-list" id="detailedCountryList">
                            <!-- Data will be loaded by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('mapDetailModal')">Tutup</button>
            </div>
        </div>
    </div>

    <div id="commodityDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Detail Distribusi Komoditas</div>
                <div class="close-modal" onclick="closeModal('commodityDetailModal')">&times;</div>
            </div>
            <div class="modal-body">
                <div class="doughnut-container">
                    <div class="doughnut-chart" id="commodityDetailChart"></div>
                    <div class="doughnut-info">
                        <div class="doughnut-total">1,248</div>
                        <div class="doughnut-label">Total Pengajuan SKA</div>
                        <div class="doughnut-detail-item">
                            <div class="doughnut-detail-color" style="background: #3B82F6;"></div>
                            <div class="doughnut-detail-label">Kopi</div>
                            <div class="doughnut-detail-value">350 (28%)</div>
                        </div>
                        <div class="doughnut-detail-item">
                            <div class="doughnut-detail-color" style="background: #10B981;"></div>
                            <div class="doughnut-detail-label">Karet</div>
                            <div class="doughnut-detail-value">275 (22%)</div>
                        </div>
                        <div class="doughnut-detail-item">
                            <div class="doughnut-detail-color" style="background: #F59E0B;"></div>
                            <div class="doughnut-detail-label">Kelapa Sawit</div>
                            <div class="doughnut-detail-value">225 (18%)</div>
                        </div>
                        <div class="doughnut-detail-item">
                            <div class="doughnut-detail-color" style="background: #8B5CF6;"></div>
                            <div class="doughnut-detail-label">Kakao</div>
                            <div class="doughnut-detail-value">150 (12%)</div>
                        </div>
                        <div class="doughnut-detail-item">
                            <div class="doughnut-detail-color" style="background: #06B6D4;"></div>
                            <div class="doughnut-detail-label">Teh</div>
                            <div class="doughnut-detail-value">125 (10%)</div>
                        </div>
                        <div class="doughnut-detail-item">
                            <div class="doughnut-detail-color" style="background: #EC4899;"></div>
                            <div class="doughnut-detail-label">Lainnya</div>
                            <div class="doughnut-detail-value">123 (10%)</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('commodityDetailModal')">Tutup</button>
            </div>
        </div>
    </div>

    <div id="allApplicationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Semua Pengajuan SKA</div>
                <div class="close-modal" onclick="closeModal('allApplicationsModal')">&times;</div>
            </div>
            <div class="modal-body">
                <div class="filter-section">
                    <div class="filter-group">
                        <label for="all-app-filter-status" class="filter-label">Status</label>
                        <select id="all-app-filter-status" class="filter-select">
                            <option value="all">Semua Status</option>
                            <option value="permohonan">Permohonan</option>
                            <option value="pemeriksaan">Pemeriksaan</option>
                            <option value="persetujuan">Persetujuan</option>
                            <option value="penerimaan">Penerimaan</option>
                            <option value="penerbitan">Penerbitan</option>
                            <option value="penolakan">Penolakan</option>
                            <option value="pengunggahan">Pengunggahan</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="all-app-filter-commodity" class="filter-label">Komoditas</label>
                        <select id="all-app-filter-commodity" class="filter-select">
                            <option value="all">Semua Komoditas</option>
                            <option value="kopi">Kopi</option>
                            <option value="karet">Karet</option>
                            <option value="kelapa_sawit">Kelapa Sawit</option>
                            <option value="kakao">Kakao</option>
                            <option value="teh">Teh</option>
                            <option value="lainnya">Lainnya</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="all-app-filter-search" class="filter-label">Cari</label>
                        <input type="text" id="all-app-filter-search" class="filter-input" placeholder="No. Pengajuan, Perusahaan...">
                    </div>
                    <div class="filter-group" style="flex-grow: 0;">
                        <button class="btn" onclick="filterAllApplications()"><i class="fas fa-filter"></i> Terapkan</button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="allApplicationsTable">
                        <thead>
                            <tr>
                                <th>No. Pengajuan <i class="fas fa-sort"></i></th>
                                <th>Perusahaan <i class="fas fa-sort"></i></th>
                                <th>Komoditas <i class="fas fa-sort"></i></th>
                                <th>Negara Tujuan <i class="fas fa-sort"></i></th>
                                <th>Tanggal <i class="fas fa-sort"></i></th>
                                <th>Status <i class="fas fa-sort"></i></th>
                                <th>Verifikator <i class="fas fa-sort"></i></th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data will be loaded by JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="pagination">
                    <button id="prevPage" onclick="changePage(-1)">Sebelumnya</button>
                    <span id="currentPage">Halaman 1</span>
                    <button id="nextPage" onclick="changePage(1)">Berikutnya</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('allApplicationsModal')">Tutup</button>
            </div>
        </div>
    </div>

    <div id="applicationDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Detail Pengajuan SKA <span id="appDetailId"></span></div>
                <div class="close-modal" onclick="closeModal('applicationDetailModal')">&times;</div>
            </div>
            <div class="modal-body">
                <div class="app-detail-tabs">
                    <div class="app-detail-tab-item active" data-tab="general-info">Informasi Umum</div>
                    <div class="app-detail-tab-item" data-tab="progress-info">Progres & Status</div>
                    <div class="app-detail-tab-item" data-tab="audit-log">Riwayat Audit</div>
                    <div class="app-detail-tab-item" data-tab="documents">Dokumen</div>
                </div>

                <div class="app-detail-tab-content active" id="general-info">
                    <div class="app-detail-info-grid">
                        <div>
                            <p><strong>Perusahaan:</strong> <span id="detail-company"></span></p>
                            <p><strong>Alamat:</strong> <span id="detail-address"></span></p>
                            <p><strong>NPWP:</strong> <span id="detail-npwp"></span></p>
                            <p><strong>NIB:</strong> <span id="detail-nib"></span></p>
                        </div>
                        <div>
                            <p><strong>Komoditas:</strong> <span id="detail-commodity"></span></p>
                            <p><strong>Negara Tujuan:</strong> <span id="detail-country"></span></p>
                            <p><strong>Tanggal Pengajuan:</strong> <span id="detail-submission-date"></span></p>
                            <p><strong>Verifikator:</strong> <span id="detail-verifier"></span></p>
                        </div>
                    </div>
                </div>

                <div class="app-detail-tab-content" id="progress-info">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress" id="detail-progress-bar">
                                <!-- Progress segments will be dynamically loaded -->
                            </div>
                        </div>
                        <div class="progress-labels" id="detail-progress-labels">
                            <!-- Progress labels will be dynamically loaded -->
                        </div>
                    </div>
                    <p style="text-align: center; margin-top: 1rem;">Status Saat Ini: <span id="detail-current-status" class="status-badge"></span></p>
                    <p style="text-align: center; margin-top: 0.5rem; font-size: 0.9rem; color: #6B7280;">Rata-rata Waktu Penyelesaian: <span id="detail-avg-time"></span></p>
                    <div style="margin-top: 1.5rem; padding: 1rem; background: #F9FAFB; border-radius: var(--border-radius); border: 1px solid #E5E7EB;">
                        <h4>Penjelasan Progres:</h4>
                        <p>Progres ini menunjukkan tahapan yang telah dan sedang dilalui oleh pengajuan SKA ini. Setiap segmen merepresentasikan status tertentu dalam alur verifikasi.</p>
                        <ul>
                            <li><b>Permohonan:</b> Pengajuan awal oleh eksportir.</li>
                            <li><b>Pemeriksaan:</b> Dokumen sedang diverifikasi oleh verifikator.</li>
                            <li><b>Persetujuan:</b> Pengajuan telah disetujui dan siap untuk penerbitan.</li>
                            <li><b>Penerimaan:</b> Pembayaran telah diterima.</li>
                            <li><b>Penerbitan:</b> SKA telah diterbitkan.</li>
                            <li><b>Penolakan:</b> Pengajuan ditolak karena alasan tertentu.</li>
                            <li><b>Pengunggahan:</b> Eksportir sedang mengunggah dokumen.</li>
                        </ul>
                    </div>
                </div>

                <div class="app-detail-tab-content" id="audit-log">
                    <div id="audit-log-list">
                        <!-- Audit log items will be dynamically loaded -->
                    </div>
                </div>

                <div class="app-detail-tab-content" id="documents">
                    <p>Daftar Dokumen Terlampir:</p>
                    <ul class="document-list" id="document-list-container">
                        <!-- Documents will be dynamically loaded -->
                    </ul>
                    <p style="margin-top: 1rem; font-size: 0.85rem; color: #6B7280;">*Ini adalah simulasi. Dalam sistem nyata, tautan ini akan mengunduh dokumen atau menampilkan pratinjau.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('applicationDetailModal')">Tutup</button>
            </div>
        </div>
    </div>

    <div id="verifierDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Detail Kinerja Verifikator</div>
                <div class="close-modal" onclick="closeModal('verifierDetailModal')">&times;</div>
            </div>
            <div class="modal-body">
                <div class="verifier-item" style="border: none; padding: 0; box-shadow: none;">
                    <div class="verifier-avatar" style="width: 60px; height: 60px; font-size: 1.5rem;" id="verifierDetailAvatar">AS</div>
                    <div class="verifier-info">
                        <div class="verifier-name" style="font-size: 1.2rem;" id="verifierDetailName">Ahmad Santoso</div>
                        <div class="verifier-stats" style="margin-top: 0.5rem;">
                            <div class="verifier-stat">
                                <i class="fas fa-envelope" style="color: var(--primary);"></i>
                                <span id="verifierDetailEmail">ahmad.santoso@ipska.kemendag.go.id</span>
                            </div>
                            <div class="verifier-stat">
                                <i class="fas fa-phone" style="color: var(--primary);"></i>
                                <span id="verifierDetailPhone">0812-3456-7890</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="kpi-section" style="margin-top: 1.5rem;">
                    <div class="kpi-card">
                        <div class="kpi-value" id="verifierDetailTotalVerif">128</div>
                        <div class="kpi-label">Total Verifikasi</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="verifierDetailAvgTime">1.1</div>
                        <div class="kpi-label">Rata-rata Hari</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="verifierDetailCompletionRate">92%</div>
                        <div class="kpi-label">Tingkat Penyelesaian</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="verifierDetailRating">4.8</div>
                        <div class="kpi-label">Rating</div>
                    </div>
                </div>

                <div class="chart-container" style="height: 300px; margin-top: 1.5rem;">
                    <div id="verifierTimelineChart"></div>
                </div>

                <div class="table-container" style="margin-top: 1.5rem;">
                    <table class="verifier-kpi-table" id="verifierDetailTable">
                        <thead>
                            <tr>
                                <th>Bulan</th>
                                <th>Jumlah Verifikasi</th>
                                <th>Rata-rata Waktu</th>
                                <th>Tingkat Penyelesaian</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data will be loaded by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('verifierDetailModal')">Tutup</button>
            </div>
        </div>
    </div>

    <div id="geographicAnalysisModal" class="modal">
        <div class="modal-content geographic-info-modal-content">
            <div class="modal-header">
                <div class="modal-title">Analisis Geografis Detail</div>
                <div class="close-modal" onclick="closeModal('geographicAnalysisModal')">&times;</div>
            </div>
            <div class="modal-body">
                <div id="analysisGeographicMap" style="height: 400px;"></div>
                <div class="geographic-info-panel" id="geographicInfoPanel">
                    <h4>Informasi Wilayah/Negara</h4>
                    <p>Klik pada marker di peta untuk melihat detail informasi geografis.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('geographicAnalysisModal')">Tutup</button>
            </div>
        </div>
    </div>

    <script>
        // Global Data (Simulated)
        const allApplicationsData = [
            { id: 'SK-2023-00456', company: 'PT. Makmur Sejahtera', commodity: 'Kopi', country: 'Amerika Serikat', date: '12 Mei 2023', status: 'pemeriksaan', verifier: 'Ahmad Santoso', address: 'Jl. Raya Bogor Km. 30, Jakarta Timur', npwp: '01.234.567.8-912.345', nib: '1234000123456', progress: [{status: 'permohonan', width: 25, label: 'Pengajuan diterima'}, {status: 'pemeriksaan', width: 50, label: 'Dokumen sedang diperiksa'}, {status: 'persetujuan', width: 25, label: 'Menunggu persetujuan'}], currentProgress: 'pemeriksaan', avgTime: '1.5 hari', auditLog: [{time: '12 Mei 2023 10:00', user: 'Sistem', action: 'Pengajuan diterima'}, {time: '12 Mei 2023 11:30', user: 'Ahmad Santoso', action: 'Mulai pemeriksaan dokumen'}], documents: [{name: 'Surat Permohonan.pdf', status: 'valid', icon: 'file-pdf'}, {name: 'Invoice.pdf', status: 'pending', icon: 'file-pdf'}, {name: 'Bill of Lading.pdf', status: 'valid', icon: 'file-pdf'}, {name: 'Sertifikat Asal.pdf', status: 'rejected', icon: 'file-pdf'}] },
            { id: 'SK-2023-00455', company: 'CV. Jaya Abadi', commodity: 'Karet', country: 'Jepang', date: '11 Mei 2023', status: 'permohonan', verifier: 'Budi Darmawan', address: 'Jl. Sudirman No. 10, Bandung', npwp: '02.345.678.9-234.567', nib: '2345000234567', progress: [{status: 'permohonan', width: 100, label: 'Pengajuan diterima'}], currentProgress: 'permohonan', avgTime: '-', auditLog: [{time: '11 Mei 2023 09:00', user: 'Sistem', action: 'Pengajuan diterima'}], documents: [{name: 'Surat Permohonan.pdf', status: 'valid', icon: 'file-pdf'}, {name: 'Dokumen Pendukung.zip', status: 'pending', icon: 'file-archive'}] },
            { id: 'SK-2023-00454', company: 'PT. Harapan Baru', commodity: 'Kelapa Sawit', country: 'India', date: '10 Mei 2023', status: 'persetujuan', verifier: 'Citra Wijaya', address: 'Jl. Gatot Subroto No. 5, Medan', npwp: '03.456.789.0-345.678', nib: '3456000345678', progress: [{status: 'permohonan', width: 30, label: 'Pengajuan diterima'}, {status: 'pemeriksaan', width: 40, label: 'Pemeriksaan selesai'}, {status: 'persetujuan', width: 30, label: 'Disetujui'}], currentProgress: 'persetujuan', avgTime: '1.0 hari', auditLog: [{time: '10 Mei 2023 08:00', user: 'Sistem', action: 'Pengajuan diterima'}, {time: '10 Mei 2023 14:00', user: 'Citra Wijaya', action: 'Pemeriksaan selesai'}, {time: '10 Mei 2023 16:00', user: 'Kepala Seksi', action: 'Pengajuan disetujui'}], documents: [{name: 'Surat Permohonan.pdf', status: 'valid', icon: 'file-pdf'}, {name: 'Laporan Survey.docx', status: 'valid', icon: 'file-word'}] },
            { id: 'SK-2023-00453', company: 'UD. Sumber Rejeki', commodity: 'Kakao', country: 'Belanda', date: '9 Mei 2023', status: 'penerbitan', verifier: 'Ahmad Santoso', address: 'Jl. Pahlawan No. 20, Surabaya', npwp: '04.567.890.1-456.789', nib: '4567000456789', progress: [{status: 'permohonan', width: 20, label: 'Pengajuan diterima'}, {status: 'pemeriksaan', width: 30, label: 'Pemeriksaan selesai'}, {status: 'persetujuan', width: 20, label: 'Disetujui'}, {status: 'penerimaan', width: 10, label: 'Pembayaran diterima'}, {status: 'penerbitan', width: 20, label: 'SKA diterbitkan'}], currentProgress: 'penerbitan', avgTime: '0.8 hari', auditLog: [{time: '09 Mei 2023 09:00', user: 'Sistem', action: 'Pengajuan diterima'}, {time: '09 Mei 2023 11:00', user: 'Ahmad Santoso', action: 'Pemeriksaan selesai'}, {time: '09 Mei 2023 13:00', user: 'Kepala Seksi', action: 'Pengajuan disetujui'}, {time: '09 Mei 2023 14:00', user: 'Sistem', action: 'Pembayaran diterima'}, {time: '09 Mei 2023 15:00', user: 'Sistem', action: 'SKA diterbitkan'}], documents: [{name: 'SKA Final.pdf', status: 'valid', icon: 'file-pdf'}, {name: 'Bukti Pembayaran.jpg', status: 'valid', icon: 'file-image'}] },
            { id: 'SK-2023-00452', company: 'PT. Bahagia Sentosa', commodity: 'Teh', country: 'Jerman', date: '8 Mei 2023', status: 'penolakan', verifier: 'Budi Darmawan', address: 'Jl. Asia Afrika No. 1, Jakarta', npwp: '05.678.901.2-567.890', nib: '5678000567890', progress: [{status: 'permohonan', width: 40, label: 'Pengajuan diterima'}, {status: 'penolakan', width: 60, label: 'Ditolak'}], currentProgress: 'penolakan', avgTime: '1.0 hari', auditLog: [{time: '08 Mei 2023 10:00', user: 'Sistem', action: 'Pengajuan diterima'}, {time: '08 Mei 2023 15:00', user: 'Budi Darmawan', action: 'Pengajuan ditolak: Dokumen tidak lengkap'}], documents: [{name: 'Surat Permohonan.pdf', status: 'valid', icon: 'file-pdf'}, {name: 'Lampiran.zip', status: 'rejected', icon: 'file-archive'}] },
            { id: 'SK-2023-00451', company: 'CV. Maju Bersama', commodity: 'Kopi', country: 'Australia', date: '7 Mei 2023', status: 'pemeriksaan', verifier: 'Citra Wijaya', address: 'Jl. Merdeka No. 12, Semarang', npwp: '06.789.012.3-678.901', nib: '6789000678901', progress: [{status: 'permohonan', width: 30, label: 'Pengajuan diterima'}, {status: 'pemeriksaan', width: 70, label: 'Dokumen sedang diperiksa'}], currentProgress: 'pemeriksaan', avgTime: '0.8 hari', auditLog: [{time: '07 Mei 2023 11:00', user: 'Sistem', action: 'Pengajuan diterima'}, {time: '07 Mei 2023 13:00', user: 'Citra Wijaya', action: 'Mulai pemeriksaan dokumen'}], documents: [{name: 'Surat Permohonan.pdf', status: 'valid', icon: 'file-pdf'}] },
            { id: 'SK-2023-00450', company: 'PT. Sejahtera Abadi', commodity: 'Kelapa Sawit', country: 'Malaysia', date: '6 Mei 2023', status: 'penerbitan', verifier: 'Ahmad Santoso', address: 'Jl. Raya Cikarang No. 50, Bekasi', npwp: '07.890.123.4-789.012', nib: '7890000789012', progress: [{status: 'permohonan', width: 20, label: 'Pengajuan diterima'}, {status: 'pemeriksaan', width: 30, label: 'Pemeriksaan selesai'}, {status: 'persetujuan', width: 20, label: 'Disetujui'}, {status: 'penerimaan', width: 10, label: 'Pembayaran diterima'}, {status: 'penerbitan', width: 20, label: 'SKA diterbitkan'}], currentProgress: 'penerbitan', avgTime: '1.0 hari', auditLog: [{time: '06 Mei 2023 09:00', user: 'Sistem', action: 'Pengajuan diterima'}, {time: '06 Mei 2023 12:00', user: 'Ahmad Santoso', action: 'Pemeriksaan selesai'}, {time: '06 Mei 2023 14:00', user: 'Kepala Seksi', action: 'Pengajuan disetujui'}, {time: '06 Mei 2023 15:00', user: 'Sistem', action: 'Pembayaran diterima'}, {time: '06 Mei 2023 16:00', user: 'Sistem', action: 'SKA diterbitkan'}], documents: [{name: 'SKA Final.pdf', status: 'valid', icon: 'file-pdf'}] },
            { id: 'SK-2023-00449', company: 'UD. Cipta Karya', commodity: 'Karet', country: 'Singapura', date: '5 Mei 2023', status: 'pengunggahan', verifier: 'Budi Darmawan', address: 'Jl. Veteran No. 3, Palembang', npwp: '08.901.234.5-890.123', nib: '8901000890123', progress: [{status: 'permohonan', width: 50, label: 'Pengajuan diterima'}, {status: 'pengunggahan', width: 50, label: 'Menunggu unggah dokumen'}], currentProgress: 'pengunggahan', avgTime: '0.5 hari', auditLog: [{time: '05 Mei 2023 10:00', user: 'Sistem', action: 'Pengajuan diterima'}, {time: '05 Mei 2023 11:00', user: 'Eksportir', action: 'Mulai unggah dokumen'}], documents: [{name: 'Surat Permohonan.pdf', status: 'pending', icon: 'file-pdf'}] },
            { id: 'SK-2023-00448', company: 'PT. Global Ekspor', commodity: 'Kopi', country: 'Vietnam', date: '4 Mei 2023', status: 'pemeriksaan', verifier: 'Citra Wijaya', address: 'Jl. Diponegoro No. 7, Yogyakarta', npwp: '09.012.345.6-901.234', nib: '9012000901234', progress: [{status: 'permohonan', width: 20, label: 'Pengajuan diterima'}, {status: 'pemeriksaan', width: 80, label: 'Dokumen sedang diperiksa'}], currentProgress: 'pemeriksaan', avgTime: '1.0 hari', auditLog: [{time: '04 Mei 2023 09:00', user: 'Sistem', action: 'Pengajuan diterima'}, {time: '04 Mei 2023 10:30', user: 'Citra Wijaya', action: 'Mulai pemeriksaan dokumen'}], documents: [{name: 'Surat Permohonan.pdf', status: 'valid', icon: 'file-pdf'}] },
            { id: 'SK-2023-00447', company: 'CV. Indah Jaya', commodity: 'Teh', country: 'Thailand', date: '3 Mei 2023', status: 'persetujuan', verifier: 'Ahmad Santoso', address: 'Jl. Kartini No. 15, Makassar', npwp: '10.123.456.7-012.345', nib: '0123000012345', progress: [{status: 'permohonan', width: 30, label: 'Pengajuan diterima'}, {status: 'pemeriksaan', width: 40, label: 'Pemeriksaan selesai'}, {status: 'persetujuan', width: 30, label: 'Disetujui'}], currentProgress: 'persetujuan', avgTime: '0.7 hari', auditLog: [{time: '03 Mei 2023 08:00', user: 'Sistem', action: 'Pengajuan diterima'}, {time: '03 Mei 2023 12:00', user: 'Ahmad Santoso', action: 'Pemeriksaan selesai'}, {time: '03 Mei 2023 14:00', user: 'Kepala Seksi', action: 'Pengajuan disetujui'}], documents: [{name: 'Surat Permohonan.pdf', status: 'valid', icon: 'file-pdf'}] },
            { id: 'SK-2023-00446', company: 'PT. Mitra Niaga', commodity: 'Kakao', country: 'Filipina', date: '2 Mei 2023', status: 'penerimaan', verifier: 'Budi Darmawan', address: 'Jl. Gajah Mada No. 25, Pontianak', npwp: '11.234.567.8-123.456', nib: '1234000123456', progress: [{status: 'permohonan', width: 20, label: 'Pengajuan diterima'}, {status: 'pemeriksaan', width: 30, label: 'Pemeriksaan selesai'}, {status: 'persetujuan', width: 20, label: 'Disetujui'}, {status: 'penerimaan', width: 30, label: 'Pembayaran diterima'}], currentProgress: 'penerimaan', avgTime: '0.6 hari', auditLog: [{time: '02 Mei 2023 10:00', user: 'Sistem', action: 'Pengajuan diterima'}, {time: '02 Mei 2023 12:00', user: 'Budi Darmawan', action: 'Pemeriksaan selesai'}, {time: '02 Mei 2023 14:00', user: 'Kepala Seksi', action: 'Pengajuan disetujui'}, {time: '02 Mei 2023 15:00', user: 'Sistem', action: 'Pembayaran diterima'}], documents: [{name: 'Surat Permohonan.pdf', status: 'valid', icon: 'file-pdf'}] },
            { id: 'SK-2023-00445', company: 'UD. Sejati Jaya', commodity: 'Kelapa Sawit', country: 'China', date: '1 Mei 2023', status: 'penolakan', verifier: 'Citra Wijaya', address: 'Jl. Imam Bonjol No. 8, Manado', npwp: '12.345.678.9-234.567', nib: '2345000234567', progress: [{status: 'permohonan', width: 30, label: 'Pengajuan diterima'}, {status: 'penolakan', width: 70, label: 'Ditolak'}], currentProgress: 'penolakan', avgTime: '0.9 hari', auditLog: [{time: '01 Mei 2023 09:00', user: 'Sistem', action: 'Pengajuan diterima'}, {time: '01 Mei 2023 14:00', user: 'Citra Wijaya', action: 'Pengajuan ditolak: Data tidak sesuai'}], documents: [{name: 'Surat Permohonan.pdf', status: 'valid', icon: 'file-pdf'}] }
        ];

        const verifiersData = {
            'AS': {
                name: 'Ahmad Santoso',
                email: 'ahmad.santoso@ipska.kemendag.go.id',
                phone: '0812-3456-7890',
                totalVerif: 128,
                avgTime: 1.1,
                completionRate: 92,
                rating: 4.8,
                timeline: [
                    { month: 'Mei 2023', verifCount: 32, avgTime: 1.0, completion: 94 },
                    { month: 'Apr 2023', verifCount: 28, avgTime: 1.1, completion: 93 },
                    { month: 'Mar 2023', verifCount: 25, avgTime: 1.2, completion: 90 },
                    { month: 'Feb 2023', verifCount: 22, avgTime: 1.3, completion: 89 },
                    { month: 'Jan 2023', verifCount: 21, avgTime: 1.2, completion: 91 }
                ]
            },
            'BD': {
                name: 'Budi Darmawan',
                email: 'budi.darmawan@ipska.kemendag.go.id',
                phone: '0813-4567-8901',
                totalVerif: 112,
                avgTime: 1.4,
                completionRate: 88,
                rating: 4.5,
                timeline: [
                    { month: 'Mei 2023', verifCount: 28, avgTime: 1.3, completion: 90 },
                    { month: 'Apr 2023', verifCount: 25, avgTime: 1.4, completion: 87 },
                    { month: 'Mar 2023', verifCount: 23, avgTime: 1.5, completion: 85 },
                    { month: 'Feb 2023', verifCount: 20, avgTime: 1.6, completion: 84 },
                    { month: 'Jan 2023', verifCount: 16, avgTime: 1.5, completion: 86 }
                ]
            },
            'CW': {
                name: 'Citra Wijaya',
                email: 'citra.wijaya@ipska.kemendag.go.id',
                phone: '0814-5678-9012',
                totalVerif: 98,
                avgTime: 1.3,
                completionRate: 90,
                rating: 4.7,
                timeline: [
                    { month: 'Mei 2023', verifCount: 25, avgTime: 1.2, completion: 92 },
                    { month: 'Apr 2023', verifCount: 22, avgTime: 1.3, completion: 91 },
                    { month: 'Mar 2023', verifCount: 20, avgTime: 1.4, completion: 88 },
                    { month: 'Feb 2023', verifCount: 18, avgTime: 1.3, completion: 89 },
                    { month: 'Jan 2023', verifCount: 13, avgTime: 1.4, completion: 87 }
                ]
            }
        };

        const geographicData = [
            { lat: -6.2088, lng: 106.8456, name: "DKI Jakarta", exporters: 120, applications: 300, commodities: { Kopi: 100, Karet: 80, Kelapa_Sawit: 70, Lainnya: 50 } },
            { lat: -6.9175, lng: 107.6191, name: "Jawa Barat", exporters: 90, applications: 250, commodities: { Kopi: 80, Teh: 70, Kakao: 60, Lainnya: 40 } },
            { lat: -7.2575, lng: 112.7521, name: "Jawa Timur", exporters: 85, applications: 220, commodities: { Karet: 90, Kelapa_Sawit: 60, Kopi: 40, Lainnya: 30 } },
            { lat: -0.5021, lng: 117.1537, name: "Kalimantan Timur", exporters: 45, applications: 100, commodities: { Kelapa_Sawit: 70, Karet: 20, Lainnya: 10 } },
            { lat: -2.9989, lng: 104.7566, name: "Sumatera Selatan", exporters: 38, applications: 90, commodities: { Karet: 50, Kopi: 20, Lainnya: 20 } },
            { lat: -5.1477, lng: 119.4327, name: "Sulawesi Selatan", exporters: 32, applications: 80, commodities: { Kakao: 40, Kopi: 30, Lainnya: 10 } },
            { lat: -3.7219, lng: 128.2007, name: "Maluku", exporters: 28, applications: 60, commodities: { Rempah: 30, Ikan: 20, Lainnya: 10 } },
            { lat: 1.5016, lng: 124.8440, name: "Sulawesi Utara", exporters: 25, applications: 55, commodities: { Kopi: 25, Kelapa: 20, Lainnya: 10 } },
            { lat: -8.6705, lng: 115.2126, name: "Bali", exporters: 22, applications: 50, commodities: { Kerajinan: 20, Kopi: 15, Lainnya: 15 } },
            { lat: -6.1751, lng: 106.8650, name: "Banten", exporters: 18, applications: 45, commodities: { Karet: 20, Kopi: 15, Lainnya: 10 } }
        ];

        // --- Utility Functions ---
        function getStatusBadgeClass(status) {
            const statusMap = {
                'permohonan': 'permohonan',
                'pemeriksaan': 'pemeriksaan',
                'persetujuan': 'persetujuan',
                'penerimaan': 'penerimaan',
                'penerbitan': 'penerbitan',
                'penolakan': 'penolakan',
                'pengunggahan': 'pengunggahan'
            };
            return statusMap[status] || '';
        }

        function getStatusDisplayName(status) {
            const statusNames = {
                'permohonan': 'Permohonan',
                'pemeriksaan': 'Pemeriksaan',
                'persetujuan': 'Persetujuan',
                'penerimaan': 'Penerimaan',
                'penerbitan': 'Penerbitan',
                'penolakan': 'Ditolak',
                'pengunggahan': 'Pengunggahan'
            };
            return statusNames[status] || status;
        }

        // --- Global Filter Functions ---
        function toggleCustomDateInputs() {
            const filterPeriod = document.getElementById('filter-period');
            const customDateRange = document.getElementById('custom-date-range');
            if (filterPeriod.value === 'custom') {
                customDateRange.style.display = 'flex';
            } else {
                customDateRange.style.display = 'none';
            }
        }

        // --- Notification Functions ---
        function markAllNotificationsRead() {
            const notificationItems = document.querySelectorAll('.notification-item');
            notificationItems.forEach(item => {
                item.classList.add('read');
                const circleIcon = item.querySelector('.fa-circle');
                if (circleIcon) {
                    circleIcon.style.display = 'none'; // Hide the circle icon
                }
            });
            document.querySelector('.notification-badge').style.display = 'none'; // Hide the badge
        }

        // --- Modal Functions ---
        function showDetailModal(type) {
            let modalId;
            switch(type) {
                case 'status':
                    modalId = 'statusDetailModal';
                    break;
                case 'map':
                    modalId = 'mapDetailModal';
                    // Re-initialize map when modal is shown
                    setTimeout(() => {
                        if (window.detailedExportersLeafletMap) {
                            window.detailedExportersLeafletMap.remove();
                        }
                        initDetailedExportersMap();
                    }, 100);
                    break;
                case 'commodities':
                    modalId = 'commodityDetailModal';
                    break;
                case 'allApplications':
                    modalId = 'allApplicationsModal';
                    loadAllApplicationsTable(); // Load data for the full table
                    break;
                case 'geographicAnalysis':
                    modalId = 'geographicAnalysisModal';
                    setTimeout(() => {
                        if (window.analysisGeographicLeafletMap) {
                            window.analysisGeographicLeafletMap.remove();
                        }
                        initAnalysisGeographicMap();
                    }, 100);
                    break;
                default:
                    return;
            }
            document.getElementById(modalId).style.display = 'flex';
        }

        function showApplicationDetail(appId) {
            const app = allApplicationsData.find(a => a.id === appId);
            if (!app) {
                console.error('Application not found:', appId);
                return;
            }

            document.getElementById('appDetailId').textContent = app.id;
            document.getElementById('detail-company').textContent = app.company;
            document.getElementById('detail-address').textContent = app.address;
            document.getElementById('detail-npwp').textContent = app.npwp;
            document.getElementById('detail-nib').textContent = app.nib;
            document.getElementById('detail-commodity').textContent = app.commodity;
            document.getElementById('detail-country').textContent = app.country;
            document.getElementById('detail-submission-date').textContent = app.date;
            document.getElementById('detail-verifier').textContent = app.verifier;

            // Progress Bar
            const progressBar = document.getElementById('detail-progress-bar');
            progressBar.innerHTML = ''; // Clear previous segments
            app.progress.forEach(segment => {
                const div = document.createElement('div');
                div.className = `progress-segment ${segment.status}`;
                div.style.width = `${segment.width}%`;
                div.title = `${segment.label || getStatusDisplayName(segment.status)}`; // Tooltip for segment
                progressBar.appendChild(div);
            });

            // Progress Labels
            const progressLabels = document.getElementById('detail-progress-labels');
            progressLabels.innerHTML = ''; // Clear previous labels
            app.progress.forEach(segment => {
                const span = document.createElement('span');
                span.textContent = `${segment.label || getStatusDisplayName(segment.status)} (${segment.width}%)`;
                progressLabels.appendChild(span);
            });

            // Current Status
            const currentStatusBadge = document.getElementById('detail-current-status');
            currentStatusBadge.className = `status-badge ${getStatusBadgeClass(app.currentProgress)}`;
            currentStatusBadge.textContent = getStatusDisplayName(app.currentProgress);

            // Average Time
            document.getElementById('detail-avg-time').textContent = app.avgTime;

            // Audit Log
            const auditLogList = document.getElementById('audit-log-list');
            auditLogList.innerHTML = '';
            if (app.auditLog && app.auditLog.length > 0) {
                app.auditLog.forEach(log => {
                    const div = document.createElement('div');
                    div.className = 'audit-log-item';
                    div.innerHTML = `<strong>${log.time}</strong> - ${log.action} oleh <span>${log.user}</span>`;
                    auditLogList.appendChild(div);
                });
            } else {
                auditLogList.innerHTML = '<p style="text-align: center; color: #6B7280;">Tidak ada riwayat audit.</p>';
            }

            // Documents
            const documentListContainer = document.getElementById('document-list-container');
            documentListContainer.innerHTML = '';
            if (app.documents && app.documents.length > 0) {
                app.documents.forEach(doc => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <a href="#" onclick="simulateDownload('${doc.name}')">
                            <i class="fas fa-${doc.icon} doc-icon"></i>
                            <span>${doc.name}</span>
                        </a>
                        <span class="doc-status ${doc.status}">${doc.status === 'valid' ? 'Valid' : doc.status === 'pending' ? 'Menunggu' : 'Ditolak'}</span>
                    `;
                    documentListContainer.appendChild(li);
                });
            } else {
                documentListContainer.innerHTML = '<p style="text-align: center; color: #6B7280;">Tidak ada dokumen terlampir.</p>';
            }

            // Reset tabs to default
            document.querySelectorAll('.app-detail-tab-item').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.app-detail-tab-content').forEach(content => content.classList.remove('active'));
            document.querySelector('.app-detail-tab-item[data-tab="general-info"]').classList.add('active');
            document.getElementById('general-info').classList.add('active');


            document.getElementById('applicationDetailModal').style.display = 'flex';
        }

        function simulateDownload(filename) {
            alert(`Simulasi: Mengunduh file "${filename}"`);
            // In a real application, you would initiate a file download here.
        }

        function showVerifierDetail(verifierId) {
            const verifier = verifiersData[verifierId];
            if (!verifier) {
                console.error('Verifier not found:', verifierId);
                return;
            }

            document.getElementById('verifierDetailAvatar').textContent = verifierId;
            document.getElementById('verifierDetailName').textContent = verifier.name;
            document.getElementById('verifierDetailEmail').textContent = verifier.email;
            document.getElementById('verifierDetailPhone').textContent = verifier.phone;
            document.getElementById('verifierDetailTotalVerif').textContent = verifier.totalVerif;
            document.getElementById('verifierDetailAvgTime').textContent = verifier.avgTime;
            document.getElementById('verifierDetailCompletionRate').textContent = `${verifier.completionRate}%`;
            document.getElementById('verifierDetailRating').textContent = verifier.rating;

            // Update Verifier Timeline Chart
            if (window.verifierTimelineChartInstance) {
                window.verifierTimelineChartInstance.destroy();
            }
            initVerifierTimelineChart(verifier.timeline);

            // Update Verifier Detail Table
            const verifierDetailTableBody = document.querySelector('#verifierDetailTable tbody');
            verifierDetailTableBody.innerHTML = '';
            verifier.timeline.forEach(data => {
                const row = verifierDetailTableBody.insertRow();
                row.insertCell().textContent = data.month;
                row.insertCell().textContent = data.verifCount;
                row.insertCell().textContent = `${data.avgTime} hari`;
                row.insertCell().textContent = `${data.completion}%`;
            });

            document.getElementById('verifierDetailModal').style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // --- Map Initialization Functions ---
        let exportersLeafletMap;
        function initExportersMap() {
            if (exportersLeafletMap) {
                exportersLeafletMap.remove();
            }
            exportersLeafletMap = L.map('exportersMap').setView([-2.5489, 118.0149], 5);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(exportersLeafletMap);
            
            // Sample data for exporters distribution (using geographicData for consistency)
            geographicData.forEach(location => {
                // Smaller radius for main map
                const radius = Math.sqrt(location.exporters) * 1.5; // Adjusted multiplier
                let color;
                
                if (location.exporters > 100) {
                    color = '#1E3A8A'; // Dark blue
                } else if (location.exporters > 50) {
                    color = '#3B82F6'; // Blue
                } else if (location.exporters > 10) {
                    color = '#93C5FD'; // Light blue
                } else {
                    color = '#BFDBFE'; // Very light blue
                }

                const circle = L.circleMarker([location.lat, location.lng], {
                    radius: radius,
                    fillColor: color,
                    color: '#fff',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(exportersLeafletMap);

                circle.bindPopup(`<b>${location.name}</b><br>${location.exporters} eksportir`);
            });
        }

        let detailedExportersLeafletMap;
        function initDetailedExportersMap() {
            if (detailedExportersLeafletMap) {
                detailedExportersLeafletMap.remove();
            }
            detailedExportersLeafletMap = L.map('detailedExportersMap').setView([-2.5489, 118.0149], 5);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(detailedExportersLeafletMap);
            
            // More detailed data for the modal map (using geographicData for consistency)
            geographicData.forEach(location => {
                // Adjusted radius for detailed map
                const radius = Math.sqrt(location.exporters) * 2; // Adjusted multiplier
                let color;
                
                if (location.exporters > 100) {
                    color = '#1E3A8A'; // Dark blue
                } else if (location.exporters > 50) {
                    color = '#3B82F6'; // Blue
                } else if (location.exporters > 10) {
                    color = '#93C5FD'; // Light blue
                } else {
                    color = '#BFDBFE'; // Very light blue
                }

                const circle = L.circleMarker([location.lat, location.lng], {
                    radius: radius,
                    fillColor: color,
                    color: '#fff',
                    weight: 1,
                    opacity: 0.8,
                    fillOpacity: 0.7
                }).addTo(detailedExportersLeafletMap);

                circle.bindPopup(`<b>${location.name}</b><br>${location.exporters} eksportir`);
                
                // Add click listener to zoom/pan to the clicked location
                circle.on('click', function() {
                    detailedExportersLeafletMap.setView([location.lat, location.lng], 8); // Zoom in to level 8
                });
            });

            // Populate detailed country list (simulated data)
            const detailedCountryList = document.getElementById('detailedCountryList');
            detailedCountryList.innerHTML = ''; // Clear previous content
            const topCountries = [
                { name: 'Amerika Serikat', flag: 'us.svg', exporters: 248 },
                { name: 'Jepang', flag: 'jp.svg', exporters: 187 },
                { name: 'Tiongkok', flag: 'cn.svg', exporters: 156 },
                { name: 'Jerman', flag: 'de.svg', exporters: 112 },
                { name: 'Belanda', flag: 'nl.svg', exporters: 98 },
                { name: 'Australia', flag: 'au.svg', exporters: 75 },
                { name: 'Malaysia', flag: 'my.svg', exporters: 60 },
                { name: 'Singapura', flag: 'sg.svg', exporters: 55 },
                { name: 'Vietnam', flag: 'vn.svg', exporters: 40 },
                { name: 'Thailand', flag: 'th.svg', exporters: 35 }
            ];

            topCountries.forEach(country => {
                const item = document.createElement('div');
                item.className = 'country-item';
                item.innerHTML = `
                    <div class="country-name">
                        <img src="https://flagcdn.com/${country.flag}" class="country-flag" alt="${country.name}">
                        <span>${country.name}</span>
                    </div>
                    <div class="country-percentage">${country.exporters} eksportir</div>
                `;
                detailedCountryList.appendChild(item);
            });
        }

        let analysisGeographicLeafletMap;
        function initAnalysisGeographicMap() {
            if (analysisGeographicLeafletMap) {
                analysisGeographicLeafletMap.remove();
            }
            analysisGeographicLeafletMap = L.map('analysisGeographicMap').setView([-2.5489, 118.0149], 5);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(analysisGeographicLeafletMap);

            const geographicInfoPanel = document.getElementById('geographicInfoPanel');
            geographicInfoPanel.innerHTML = '<h4>Informasi Wilayah/Negara</h4><p>Klik pada marker di peta untuk melihat detail informasi geografis.</p>';

            geographicData.forEach(location => {
                const marker = L.marker([location.lat, location.lng]).addTo(analysisGeographicLeafletMap);
                
                // Bind a popup that shows basic info immediately
                marker.bindPopup(`<b>${location.name}</b><br>${location.exporters} eksportir<br>${location.applications} pengajuan`);

                // On click, update the side panel and zoom
                marker.on('click', function() {
                    displayGeographicInfo(location);
                    analysisGeographicLeafletMap.setView([location.lat, location.lng], 8); // Zoom in to level 8
                });
                marker.bindTooltip(location.name, {permanent: false, direction: "top"});
            });
        }

        function displayGeographicInfo(location) {
            const geographicInfoPanel = document.getElementById('geographicInfoPanel');
            let commoditiesHtml = '<ul>';
            for (const [commodity, count] of Object.entries(location.commodities)) {
                commoditiesHtml += `<li><span>${commodity.replace(/_/g, ' ')}</span><span>${count} pengajuan</span></li>`;
            }
            commoditiesHtml += '</ul>';

            geographicInfoPanel.innerHTML = `
                <h4>${location.name}</h4>
                <p><strong>Jumlah Eksportir:</strong> ${location.exporters}</p>
                <p><strong>Total Pengajuan SKA:</strong> ${location.applications}</p>
                <p><strong>Komoditas Utama:</strong></p>
                ${commoditiesHtml}
            `;
        }

        // --- Chart Initialization Functions ---
        let commodityChartInstance;
        function initCommodityChart() {
            // This chart is replaced by Bar Chart Race in the main view
            // The function is kept for potential future use or if the race chart is moved to detail
        }

        let commodityDetailChartInstance;
        function initCommodityDetailChart() {
            const options = {
                series: [350, 275, 225, 150, 125, 123],
                chart: {
                    type: 'donut',
                    height: '100%'
                },
                labels: ['Kopi', 'Karet', 'Kelapa Sawit', 'Kakao', 'Teh', 'Lainnya'],
                colors: ['#3B82F6', '#10B981', '#F59E0B', '#8B5CF6', '#06B6D4', '#EC4899'],
                legend: {
                    show: false
                },
                dataLabels: {
                    enabled: false
                },
                plotOptions: {
                    pie: {
                        donut: {
                            size: '65%',
                            labels: {
                                show: true,
                                total: {
                                    show: true,
                                    label: 'Total',
                                    formatter: function(w) {
                                        return w.globals.seriesTotals.reduce((a, b) => a + b, 0);
                                    }
                                }
                            }
                        }
                    }
                },
                responsive: [{
                    breakpoint: 480,
                    options: {
                        chart: {
                            width: 200
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }]
            };

            if (commodityDetailChartInstance) {
                commodityDetailChartInstance.destroy();
            }
            commodityDetailChartInstance = new ApexCharts(document.querySelector("#commodityDetailChart"), options);
            commodityDetailChartInstance.render();
        }

        let statusDetailChartInstance;
        function initStatusDetailChart() {
            const options = {
                series: [{
                    name: 'Jumlah',
                    data: [250, 312, 250, 125, 187, 62, 62]
                }],
                chart: {
                    type: 'bar',
                    height: '100%',
                    toolbar: {
                        show: false
                    }
                },
                plotOptions: {
                    bar: {
                        borderRadius: 4,
                        horizontal: false,
                        distributed: true
                    }
                },
                colors: ['#3B82F6', '#8B5CF6', '#10B981', '#059669', '#06B6D4', '#EF4444', '#F59E0B'],
                dataLabels: {
                    enabled: false
                },
                xaxis: {
                    categories: ['Permohonan', 'Pemeriksaan', 'Persetujuan', 'Penerimaan', 'Penerbitan', 'Ditolak', 'Pengunggahan'],
                    title: {
                        text: 'Status'
                    }
                },
                yaxis: {
                    title: {
                        text: 'Jumlah Pengajuan'
                    }
                },
                tooltip: {
                    y: {
                        formatter: function(val) {
                            return val + " pengajuan";
                        }
                    }
                }
            };

            if (statusDetailChartInstance) {
                statusDetailChartInstance.destroy();
            }
            statusDetailChartInstance = new ApexCharts(document.querySelector("#statusDetailChart"), options);
            statusDetailChartInstance.render();
        }

        let trendChartInstance;
        function initTrendChart() {
            const period = document.getElementById('trend-chart-period').value;
            let categories, dataPengajuan, dataDisetujui;

            // Simulated data based on period
            if (period === 'monthly') {
                categories = ['Des 2022', 'Jan 2023', 'Feb 2023', 'Mar 2023', 'Apr 2023', 'Mei 2023'];
                dataPengajuan = [1050, 1100, 1150, 1200, 1120, 1248];
                dataDisetujui = [800, 850, 900, 920, 880, 942];
            } else if (period === 'quarterly') {
                categories = ['Q4 2022', 'Q1 2023', 'Q2 2023'];
                dataPengajuan = [3000, 3500, 3700];
                dataDisetujui = [2500, 2900, 3100];
            } else if (period === 'yearly') {
                categories = ['2021', '2022', '2023'];
                dataPengajuan = [10000, 12000, 14000];
                dataDisetujui = [8500, 10500, 12000];
            }

            const options = {
                series: [{
                    name: 'Pengajuan',
                    data: dataPengajuan
                }, {
                    name: 'Disetujui',
                    data: dataDisetujui
                }],
                chart: {
                    height: '100%',
                    type: 'line',
                    zoom: {
                        enabled: false
                    },
                    toolbar: {
                        show: false
                    }
                },
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    curve: 'smooth',
                    width: [3, 3]
                },
                colors: ['#3B82F6', '#10B981'],
                xaxis: {
                    categories: categories,
                },
                yaxis: {
                    title: {
                        text: 'Jumlah'
                    }
                },
                legend: {
                    position: 'top'
                },
                tooltip: {
                    y: {
                        formatter: function(val) {
                            return val + " pengajuan";
                        }
                    }
                }
            };

            if (trendChartInstance) {
                trendChartInstance.destroy();
            }
            trendChartInstance = new ApexCharts(document.querySelector("#trendChart"), options);
            trendChartInstance.render();
        }

        let verifierPerformanceChartInstance;
        function initVerifierPerformanceChart() {
            const options = {
                series: [{
                    name: 'Verifikasi',
                    data: [128, 112, 98, 85, 76]
                }],
                chart: {
                    type: 'bar',
                    height: '100%',
                    toolbar: {
                        show: false
                    }
                },
                plotOptions: {
                    bar: {
                        borderRadius: 4,
                        horizontal: false,
                    }
                },
                colors: ['#1E3A8A'],
                dataLabels: {
                    enabled: false
                },
                xaxis: {
                    categories: ['Ahmad Santoso', 'Budi Darmawan', 'Citra Wijaya', 'Dewi Kusuma', 'Eko Prasetyo'],
                    title: {
                        text: 'Verifikator'
                    }
                },
                yaxis: {
                    title: {
                        text: 'Jumlah Verifikasi'
                    }
                },
                tooltip: {
                    y: {
                        formatter: function(val) {
                            return val + " verifikasi";
                        }
                    }
                }
            };

            if (verifierPerformanceChartInstance) {
                verifierPerformanceChartInstance.destroy();
            }
            verifierPerformanceChartInstance = new ApexCharts(document.querySelector("#verifierPerformanceChart"), options);
            verifierPerformanceChartInstance.render();
        }

        let performanceComparisonChartInstance;
        function initPerformanceComparisonChart() {
            const period = document.getElementById('comparison-period').value;
            let labels, dataAvgTime, dataCompletion;

            // Simulated data based on period
            if (period === 'monthly') {
                labels = ['Ahmad Santoso', 'Budi Darmawan', 'Citra Wijaya', 'Dewi Kusuma', 'Eko Prasetyo'];
                dataAvgTime = [1.1, 1.4, 1.3, 1.5, 1.6];
                dataCompletion = [92, 88, 90, 85, 82];
            } else if (period === 'quarterly') {
                labels = ['Ahmad Santoso', 'Budi Darmawan', 'Citra Wijaya'];
                dataAvgTime = [1.0, 1.3, 1.2];
                dataCompletion = [95, 90, 93];
            } else if (period === 'yearly') {
                labels = ['Ahmad Santoso', 'Budi Darmawan'];
                dataAvgTime = [0.9, 1.1];
                dataCompletion = [96, 92];
            }

            const options = {
                series: [
                    {
                        name: 'Rata-rata Waktu',
                        type: 'column',
                        data: dataAvgTime
                    }, 
                    {
                        name: 'Tingkat Penyelesaian',
                        type: 'line',
                        data: dataCompletion
                    }
                ],
                chart: {
                    height: '100%',
                    type: 'line',
                    toolbar: {
                        show: false
                    }
                },
                stroke: {
                    width: [0, 3]
                },
                colors: ['#3B82F6', '#10B981'],
                dataLabels: {
                    enabled: true,
                    enabledOnSeries: [1]
                },
                labels: labels,
                xaxis: {
                    type: 'category'
                },
                yaxis: [
                    {
                        title: {
                            text: 'Hari',
                        },
                        min: 0,
                        max: 2
                    },
                    {
                        opposite: true,
                        title: {
                            text: 'Persentase'
                        },
                        min: 80,
                        max: 100
                    }
                ],
                legend: {
                    position: 'top'
                },
                tooltip: {
                    y: [
                        {
                            formatter: function(val) {
                                return val + " hari";
                            }
                        },
                        {
                            formatter: function(val) {
                                return val + "%";
                            }
                        }
                    ]
                }
            };

            if (performanceComparisonChartInstance) {
                performanceComparisonChartInstance.destroy();
            }
            performanceComparisonChartInstance = new ApexCharts(document.querySelector("#performanceComparisonChart"), options);
            performanceComparisonChartInstance.render();
        }

        let verifierTimelineChartInstance;
        function initVerifierTimelineChart(data = verifiersData['AS'].timeline) { // Default to Ahmad Santoso's data
            const options = {
                series: [{
                    name: 'Jumlah Verifikasi',
                    data: data.map(d => d.verifCount)
                }],
                chart: {
                    type: 'bar',
                    height: '100%',
                    toolbar: {
                        show: false
                    }
                },
                plotOptions: {
                    bar: {
                        borderRadius: 4,
                        horizontal: false,
                    }
                },
                colors: ['#1E3A8A'],
                dataLabels: {
                    enabled: false
                },
                xaxis: {
                    categories: data.map(d => d.month),
                    title: {
                        text: 'Bulan'
                    }
                },
                yaxis: {
                    title: {
                        text: 'Jumlah Verifikasi'
                    }
                },
                tooltip: {
                    y: {
                        formatter: function(val) {
                            return val + " verifikasi";
                        }
                    }
                }
            };

            if (verifierTimelineChartInstance) {
                verifierTimelineChartInstance.destroy();
            }
            verifierTimelineChartInstance = new ApexCharts(document.querySelector("#verifierTimelineChart"), options);
            verifierTimelineChartInstance.render();
        }

        let commodityPerformanceChartInstance;
        function initCommodityPerformanceChart() {
            const period = document.getElementById('commodity-perf-period').value;
            const topN = parseInt(document.getElementById('commodity-perf-top-n').value);
            
            // Simulated data based on period and topN
            let commoditiesData = [
                { name: 'Kopi', applications: 350, approval: 95 },
                { name: 'Karet', applications: 275, approval: 88 },
                { name: 'Kelapa Sawit', applications: 225, approval: 90 },
                { name: 'Kakao', applications: 150, approval: 85 },
                { name: 'Teh', applications: 125, approval: 92 },
                { name: 'Cengkeh', applications: 80, approval: 87 },
                { name: 'Vanila', applications: 60, approval: 93 },
                { name: 'Rempa-rempah', applications: 50, approval: 89 },
                { name: 'Ikan', applications: 40, approval: 91 },
                { name: 'Tekstil', applications: 30, approval: 80 }
            ];

            if (period === 'quarterly') {
                commoditiesData = commoditiesData.map(c => ({ ...c, applications: c.applications * 0.8, approval: c.approval + (Math.random() * 5 - 2.5) }));
            } else if (period === 'yearly') {
                commoditiesData = commoditiesData.map(c => ({ ...c, applications: c.applications * 2.5, approval: c.approval + (Math.random() * 5 - 2.5) }));
            }

            commoditiesData.sort((a, b) => b.applications - a.applications);
            const filteredData = topN === 'all' ? commoditiesData : commoditiesData.slice(0, topN);

            const categories = filteredData.map(d => d.name);
            const dataApplications = filteredData.map(d => d.applications);
            const dataApproval = filteredData.map(d => d.approval);

            const options = {
                series: [{
                    name: 'Jumlah Pengajuan',
                    data: dataApplications
                }, {
                    name: 'Tingkat Persetujuan (%)',
                    data: dataApproval
                }],
                chart: {
                    height: '100%',
                    type: 'line',
                    toolbar: {
                        show: false
                    }
                },
                stroke: {
                    curve: 'smooth',
                    width: [3, 3]
                },
                colors: ['#3B82F6', '#10B981'],
                xaxis: {
                    categories: categories,
                },
                yaxis: [
                    {
                        title: {
                            text: 'Jumlah Pengajuan',
                        },
                    },
                    {
                        opposite: true,
                        title: {
                            text: 'Tingkat Persetujuan (%)'
                        },
                        min: 0,
                        max: 100
                    }
                ],
                legend: {
                    position: 'top'
                },
                tooltip: {
                    y: [
                        {
                            formatter: function(val) {
                                return val + " pengajuan";
                            }
                        },
                        {
                            formatter: function(val) {
                                return val.toFixed(1) + "%";
                            }
                        }
                    ]
                }
            };

            if (commodityPerformanceChartInstance) {
                commodityPerformanceChartInstance.destroy();
            }
            commodityPerformanceChartInstance = new ApexCharts(document.querySelector("#commodityPerformanceChart"), options);
            commodityPerformanceChartInstance.render();
        }

        let verificationEfficiencyChartInstance;
        function initVerificationEfficiencyChart() {
            const period = document.getElementById('efficiency-period').value;
            let dataAvgTime;

            if (period === 'monthly') {
                dataAvgTime = [1.5, 0.5, 0.2, 0.3, 1.2, 0.1];
            } else if (period === 'quarterly') {
                dataAvgTime = [1.4, 0.6, 0.3, 0.4, 1.1, 0.2];
            } else if (period === 'yearly') {
                dataAvgTime = [1.3, 0.7, 0.4, 0.5, 1.0, 0.3];
            }

            const options = {
                series: [{
                    name: 'Rata-rata Waktu (Hari)',
                    data: dataAvgTime
                }],
                chart: {
                    type: 'bar',
                    height: '100%',
                    toolbar: {
                        show: false
                    }
                },
                plotOptions: {
                    bar: {
                        borderRadius: 4,
                        horizontal: false,
                        distributed: true
                    }
                },
                colors: ['#8B5CF6', '#10B981', '#059669', '#06B6D4', '#EF4444', '#F59E0B'],
                dataLabels: {
                    enabled: false
                },
                xaxis: {
                    categories: ['Pemeriksaan', 'Persetujuan', 'Penerimaan', 'Penerbitan', 'Penolakan', 'Pengunggahan'],
                    title: {
                        text: 'Tahapan Proses'
                    }
                },
                yaxis: {
                    title: {
                        text: 'Rata-rata Waktu (Hari)'
                    }
                },
                tooltip: {
                    y: {
                        formatter: function(val) {
                            return val + " hari";
                        }
                    }
                }
            };

            if (verificationEfficiencyChartInstance) {
                verificationEfficiencyChartInstance.destroy();
            }
            verificationEfficiencyChartInstance = new ApexCharts(document.querySelector("#verificationEfficiencyChart"), options);
            verificationEfficiencyChartInstance.render();
        }

        let exporterComplianceChartInstance;
        function initExporterComplianceChart() {
            const period = document.getElementById('compliance-period').value;
            let dataReasons;

            if (period === 'monthly') {
                dataReasons = [45, 30, 15, 10];
            } else if (period === 'quarterly') {
                dataReasons = [40, 35, 15, 10];
            } else if (period === 'yearly') {
                dataReasons = [50, 25, 15, 10];
            }

            const options = {
                series: dataReasons,
                chart: {
                    type: 'pie',
                    height: '100%'
                },
                labels: ['Dokumen Tidak Lengkap', 'Data Tidak Sesuai', 'Format Salah', 'Lainnya'],
                colors: ['#EF4444', '#F59E0B', '#3B82F6', '#6B7280'],
                legend: {
                    position: 'bottom'
                },
                responsive: [{
                    breakpoint: 480,
                    options: {
                        chart: {
                            width: 200
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }]
            };

            if (exporterComplianceChartInstance) {
                exporterComplianceChartInstance.destroy();
            }
            exporterComplianceChartInstance = new ApexCharts(document.querySelector("#exporterComplianceChart"), options);
            exporterComplianceChartInstance.render();
        }

        let policyImpactChartInstance;
        function initPolicyImpactChart() {
            const period = document.getElementById('policy-period').value;
            let categories, dataApplications;

            if (period === 'monthly') {
                categories = ['Okt 2022', 'Nov 2022', 'Des 2022', 'Jan 2023', 'Feb 2023', 'Mar 2023'];
                dataApplications = [100, 110, 125, 130, 140, 150];
            } else if (period === 'quarterly') {
                categories = ['Q3 2022', 'Q4 2022', 'Q1 2023'];
                dataApplications = [300, 350, 400];
            } else if (period === 'yearly') {
                categories = ['2021', '2022', '2023'];
                dataApplications = [1000, 1200, 1500];
            }

            const options = {
                series: [{
                    name: 'Pengajuan SKA',
                    data: dataApplications
                }],
                annotations: {
                    xaxis: [{
                        x: 'Jan 2023', // Assuming policy change in Jan 2023
                        borderColor: '#775DD0',
                        label: {
                            borderColor: '#775DD0',
                            style: {
                                color: '#fff',
                                background: '#775DD0',
                            },
                            text: 'Kebijakan Baru',
                        }
                    }]
                },
                chart: {
                    height: '100%',
                    type: 'line',
                    toolbar: {
                        show: false
                    }
                },
                stroke: {
                    curve: 'smooth'
                },
                xaxis: {
                    categories: categories,
                },
                yaxis: {
                    title: {
                        text: 'Jumlah Pengajuan'
                    }
                },
                tooltip: {
                    y: {
                        formatter: function(val) {
                            return val + " pengajuan";
                        }
                    }
                }
            };

            if (policyImpactChartInstance) {
                policyImpactChartInstance.destroy();
            }
            policyImpactChartInstance = new ApexCharts(document.querySelector("#policyImpactChart"), options);
            policyImpactChartInstance.render();
        }

        let myPerformanceChartInstance;
        function initMyPerformanceChart() {
            const options = {
                series: [{
                    name: 'Verifikasi Selesai',
                    data: [25, 28, 32, 29, 30]
                }, {
                    name: 'Rata-rata Waktu (Hari)',
                    data: [1.2, 1.1, 1.0, 1.3, 1.1]
                }],
                chart: {
                    height: '100%',
                    type: 'line',
                    toolbar: {
                        show: false
                    }
                },
                stroke: {
                    curve: 'smooth',
                    width: [3, 3]
                },
                colors: ['#3B82F6', '#F59E0B'],
                xaxis: {
                    categories: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei'],
                },
                yaxis: [
                    {
                        title: {
                            text: 'Jumlah Verifikasi',
                        },
                    },
                    {
                        opposite: true,
                        title: {
                            text: 'Rata-rata Waktu (Hari)'
                        },
                    }
                ],
                legend: {
                    position: 'top'
                },
                tooltip: {
                    y: [
                        {
                            formatter: function(val) {
                                return val + " verifikasi";
                            }
                        },
                        {
                            formatter: function(val) {
                                return val + " hari";
                            }
                        }
                    ]
                }
            };

            if (myPerformanceChartInstance) {
                myPerformanceChartInstance.destroy();
            }
            myPerformanceChartInstance = new ApexCharts(document.querySelector("#myPerformanceChart"), options);
            myPerformanceChartInstance.render();
        }

        // --- Bar Chart Race (D3.js) ---
        let raceChartInterval;
        const raceChartData = {
            monthly: [
                { date: '2023-01-01', values: [{ name: 'Kopi', value: 100 }, { name: 'Karet', value: 80 }, { name: 'Kelapa Sawit', value: 70 }, { name: 'Kakao', value: 50 }, { name: 'Teh', value: 40 }, { name: 'Cengkeh', value: 30 }, { name: 'Vanila', value: 20 }, { name: 'Rempah-rempah', value: 15 }, { name: 'Ikan', value: 10 }, { name: 'Tekstil', value: 5 }] },
                { date: '2023-02-01', values: [{ name: 'Kopi', value: 110 }, { name: 'Karet', value: 85 }, { name: 'Kelapa Sawit', value: 75 }, { name: 'Kakao', value: 55 }, { name: 'Teh', value: 45 }, { name: 'Cengkeh', value: 32 }, { name: 'Vanila', value: 22 }, { name: 'Rempah-rempah', value: 17 }, { name: 'Ikan', value: 12 }, { name: 'Tekstil', value: 7 }] },
                { date: '2023-03-01', values: [{ name: 'Kopi', value: 120 }, { name: 'Karet', value: 90 }, { name: 'Kelapa Sawit', value: 80 }, { name: 'Kakao', value: 60 }, { name: 'Teh', value: 50 }, { name: 'Cengkeh', value: 35 }, { name: 'Vanila', value: 25 }, { name: 'Rempah-rempah', value: 20 }, { name: 'Ikan', value: 15 }, { name: 'Tekstil', value: 10 }] },
                { date: '2023-04-01', values: [{ name: 'Kopi', value: 130 }, { name: 'Karet', value: 95 }, { name: 'Kelapa Sawit', value: 85 }, { name: 'Kakao', value: 65 }, { name: 'Teh', value: 55 }, { name: 'Cengkeh', value: 38 }, { name: 'Vanila', value: 28 }, { name: 'Rempah-rempah', value: 22 }, { name: 'Ikan', value: 17 }, { name: 'Tekstil', value: 12 }] },
                { date: '2023-05-01', values: [{ name: 'Kopi', value: 140 }, { name: 'Karet', value: 100 }, { name: 'Kelapa Sawit', value: 90 }, { name: 'Kakao', value: 70 }, { name: 'Teh', value: 60 }, { name: 'Cengkeh', value: 40 }, { name: 'Vanila', value: 30 }, { name: 'Rempah-rempah', value: 25 }, { name: 'Ikan', value: 20 }, { name: 'Tekstil', value: 15 }] },
                { date: '2023-06-01', values: [{ name: 'Kopi', value: 150 }, { name: 'Karet', value: 105 }, { name: 'Kelapa Sawit', value: 95 }, { name: 'Kakao', value: 75 }, { name: 'Teh', value: 65 }, { name: 'Cengkeh', value: 42 }, { name: 'Vanila', value: 32 }, { name: 'Rempah-rempah', value: 27 }, { name: 'Ikan', value: 22 }, { name: 'Tekstil', value: 17 }] }
            ],
            quarterly: [
                { date: 'Q1 2022', values: [{ name: 'Kopi', value: 300 }, { name: 'Karet', value: 250 }, { name: 'Kelapa Sawit', value: 200 }, { name: 'Kakao', value: 150 }, { name: 'Teh', value: 100 }] },
                { date: 'Q2 2022', values: [{ name: 'Kopi', value: 320 }, { name: 'Karet', value: 260 }, { name: 'Kelapa Sawit', value: 210 }, { name: 'Kakao', value: 160 }, { name: 'Teh', value: 110 }] },
                { date: 'Q3 2022', values: [{ name: 'Kopi', value: 340 }, { name: 'Karet', value: 270 }, { name: 'Kelapa Sawit', value: 220 }, { name: 'Kakao', value: 170 }, { name: 'Teh', value: 120 }] },
                { date: 'Q4 2022', values: [{ name: 'Kopi', value: 360 }, { name: 'Karet', value: 280 }, { name: 'Kelapa Sawit', value: 230 }, { name: 'Kakao', value: 180 }, { name: 'Teh', value: 130 }] },
                { date: 'Q1 2023', values: [{ name: 'Kopi', value: 380 }, { name: 'Karet', value: 290 }, { name: 'Kelapa Sawit', value: 240 }, { name: 'Kakao', value: 190 }, { name: 'Teh', value: 140 }] },
                { date: 'Q2 2023', values: [{ name: 'Kopi', value: 400 }, { name: 'Karet', value: 300 }, { name: 'Kelapa Sawit', value: 250 }, { name: 'Kakao', value: 200 }, { name: 'Teh', value: 150 }] }
            ],
            yearly: [
                { date: '2020', values: [{ name: 'Kopi', value: 1000 }, { name: 'Karet', value: 800 }, { name: 'Kelapa Sawit', value: 700 }, { name: 'Kakao', value: 500 }, { name: 'Teh', value: 400 }] },
                { date: '2021', values: [{ name: 'Kopi', value: 1100 }, { name: 'Karet', value: 850 }, { name: 'Kelapa Sawit', value: 750 }, { name: 'Kakao', value: 550 }, { name: 'Teh', value: 450 }] },
                { date: '2022', values: [{ name: 'Kopi', value: 1200 }, { name: 'Karet', value: 900 }, { name: 'Kelapa Sawit', value: 800 }, { name: 'Kakao', value: 600 }, { name: 'Teh', value: 500 }] },
                { date: '2023', values: [{ name: 'Kopi', value: 1300 }, { name: 'Karet', value: 950 }, { name: 'Kelapa Sawit', value: 850 }, { name: 'Kakao', value: 650 }, { name: 'Teh', value: 550 }] }
            ]
        };

        function updateRaceChartPeriod() {
            initRaceChart(); // Re-initialize chart with new period/top N
        }

        function initRaceChart() {
            const period = document.getElementById('race-chart-period').value;
            const topN = parseInt(document.getElementById('race-chart-top-n').value);
            let data = raceChartData[period];

            // Filter data based on topN
            if (topN !== 'all') {
                data = data.map(d => ({
                    date: d.date,
                    values: d.values.sort((a, b) => b.value - a.value).slice(0, topN)
                }));
            }

            const container = d3.select("#raceChart");
            container.html(''); // Clear previous chart
            const svg = container.append("svg");

            const margin = { top: 20, right: 30, bottom: 30, left: 100 };
            const width = parseInt(container.style("width")) - margin.left - margin.right;
            const height = parseInt(container.style("height")) - margin.top - margin.bottom;

            const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleLinear().range([0, width]);
            const y = d3.scaleBand().range([height, 0]).padding(0.1);

            const color = d3.scaleOrdinal(d3.schemeCategory10);

            const xAxis = g.append("g").attr("class", "race-axis").attr("transform", `translate(0,${height})`);
            const yAxis = g.append("g").attr("class", "race-axis");

            const dateText = g.append("text")
                .attr("class", "race-date")
                .attr("x", width - 10)
                .attr("y", height - 10)
                .attr("text-anchor", "end");

            let currentIndex = 0;

            function update(dataPoint) {
                const sortedData = dataPoint.values.sort((a, b) => b.value - a.value);

                x.domain([0, d3.max(sortedData, d => d.value)]);
                y.domain(sortedData.map(d => d.name));

                xAxis.transition().duration(500).call(d3.axisBottom(x));
                yAxis.transition().duration(500).call(d3.axisLeft(y));

                const bars = g.selectAll(".race-bar")
                    .data(sortedData, d => d.name);

                bars.enter()
                    .append("rect")
                    .attr("class", "race-bar")
                    .attr("y", d => y(d.name))
                    .attr("height", y.bandwidth())
                    .attr("x", 0)
                    .attr("width", 0)
                    .attr("fill", d => color(d.name))
                    .transition()
                    .duration(500)
                    .attr("width", d => x(d.value));

                bars.transition()
                    .duration(500)
                    .attr("y", d => y(d.name))
                    .attr("width", d => x(d.value));

                bars.exit()
                    .transition()
                    .duration(500)
                    .attr("width", 0)
                    .remove();

                const labels = g.selectAll(".race-bar-label")
                    .data(sortedData, d => d.name);

                labels.enter()
                    .append("text")
                    .attr("class", "race-bar-label")
                    .attr("y", d => y(d.name) + y.bandwidth() / 2)
                    .attr("x", -5)
                    .text(d => d.name)
                    .transition()
                    .duration(500)
                    .attr("y", d => y(d.name) + y.bandwidth() / 2);

                labels.transition()
                    .duration(500)
                    .attr("y", d => y(d.name) + y.bandwidth() / 2);

                labels.exit()
                    .transition()
                    .duration(500)
                    .remove();

                const values = g.selectAll(".race-bar-value")
                    .data(sortedData, d => d.name);

                values.enter()
                    .append("text")
                    .attr("class", "race-bar-value")
                    .attr("y", d => y(d.name) + y.bandwidth() / 2)
                    .attr("x", d => x(d.value) - 5)
                    .text(d => d.value)
                    .transition()
                    .duration(500)
                    .attr("x", d => x(d.value) - 5);

                values.transition()
                    .duration(500)
                    .attr("y", d => y(d.name) + y.bandwidth() / 2)
                    .attr("x", d => x(d.value) - 5)
                    .text(d => d.value);

                values.exit()
                    .transition()
                    .duration(500)
                    .remove();

                dateText.text(dataPoint.date);
            }

            // Clear any existing interval
            if (raceChartInterval) {
                clearInterval(raceChartInterval);
            }

            // Initial render
            update(data[currentIndex]);

            // Start animation
            raceChartInterval = setInterval(() => {
                currentIndex++;
                if (currentIndex >= data.length) {
                    currentIndex = 0; // Loop back to start
                }
                update(data[currentIndex]);
            }, 2000); // Update every 2 seconds
        }

        // --- All Applications Table Functions ---
        let currentPage = 1;
        const rowsPerPage = 10;
        let filteredApplications = [];

        function loadAllApplicationsTable() {
            filteredApplications = allApplicationsData; // Start with all data
            filterAllApplications(); // Apply initial filters
        }

        function renderApplicationsTable() {
            const tableBody = document.querySelector('#allApplicationsTable tbody');
            tableBody.innerHTML = ''; // Clear existing rows

            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;
            const paginatedData = filteredApplications.slice(startIndex, endIndex);

            paginatedData.forEach(app => {
                const row = tableBody.insertRow();
                row.insertCell().textContent = app.id;
                row.insertCell().textContent = app.company;
                row.insertCell().textContent = app.commodity;
                row.insertCell().textContent = app.country;
                row.insertCell().textContent = app.date;
                const statusCell = row.insertCell();
                statusCell.innerHTML = `<span class="status-badge ${getStatusBadgeClass(app.status)}">${getStatusDisplayName(app.status)}</span>`;
                row.insertCell().textContent = app.verifier;
                const actionCell = row.insertCell();
                actionCell.innerHTML = `<button class="btn" onclick="showApplicationDetail('${app.id}')">Detail</button>`;
            });

            document.getElementById('currentPage').textContent = `Halaman ${currentPage} dari ${Math.ceil(filteredApplications.length / rowsPerPage)}`;
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === Math.ceil(filteredApplications.length / rowsPerPage);
        }

        function filterAllApplications() {
            const statusFilter = document.getElementById('all-app-filter-status').value;
            const commodityFilter = document.getElementById('all-app-filter-commodity').value;
            const searchFilter = document.getElementById('all-app-filter-search').value.toLowerCase();

            filteredApplications = allApplicationsData.filter(app => {
                const matchesStatus = statusFilter === 'all' || app.status === statusFilter;
                const matchesCommodity = commodityFilter === 'all' || app.commodity.toLowerCase().replace(' ', '_') === commodityFilter;
                const matchesSearch = app.id.toLowerCase().includes(searchFilter) ||
                                      app.company.toLowerCase().includes(searchFilter) ||
                                      app.commodity.toLowerCase().includes(searchFilter) ||
                                      app.country.toLowerCase().includes(searchFilter) ||
                                      app.verifier.toLowerCase().includes(searchFilter);
                return matchesStatus && matchesCommodity && matchesSearch;
            });

            currentPage = 1; // Reset to first page after filtering
            renderApplicationsTable();
        }

        function changePage(direction) {
            const totalPages = Math.ceil(filteredApplications.length / rowsPerPage);
            currentPage += direction;
            if (currentPage < 1) currentPage = 1;
            if (currentPage > totalPages) currentPage = totalPages;
            renderApplicationsTable();
        }

        // --- Custom Report Functions ---
        function generateReport() {
            const reportType = document.getElementById('report-type').value;
            const startDate = document.getElementById('report-start-date').value;
            const endDate = document.getElementById('report-end-date').value;
            const reportPreview = document.getElementById('reportPreview');
            const downloadReportBtn = document.getElementById('downloadReportBtn');

            if (!startDate || !endDate) {
                reportPreview.innerHTML = '<p style="color: var(--danger);">Mohon lengkapi tanggal mulai dan tanggal akhir.</p>';
                downloadReportBtn.style.display = 'none';
                return;
            }

            // Simulate data filtering based on date range
            const filteredData = allApplicationsData.filter(app => {
                // Convert "DD Mon YYYY" to "YYYY-MM-DD" for Date object comparison
                const appDateParts = app.date.split(' ');
                const monthMap = { 'Jan': '01', 'Feb': '02', 'Mar': '03', 'Apr': '04', 'Mei': '05', 'Jun': '06', 'Jul': '07', 'Agu': '08', 'Sep': '09', 'Okt': '10', 'Nov': '11', 'Des': '12' };
                const formattedAppDate = `${appDateParts[2]}-${monthMap[appDateParts[1]]}-${appDateParts[0]}`;
                
                const appDate = new Date(formattedAppDate);
                const start = new Date(startDate);
                const end = new Date(endDate);
                
                // Set time to 00:00:00 for accurate date comparison
                appDate.setHours(0,0,0,0);
                start.setHours(0,0,0,0);
                end.setHours(0,0,0,0);

                return appDate >= start && appDate <= end;
            });

            let previewContent = '';
            switch (reportType) {
                case 'status_summary':
                    const statusCounts = {};
                    filteredData.forEach(app => {
                        statusCounts[app.status] = (statusCounts[app.status] || 0) + 1;
                    });
                    previewContent += '<h4>Ringkasan Status Pengajuan</h4>';
                    previewContent += `<p>Periode: ${startDate} s/d ${endDate}</p>`;
                    previewContent += `<p>Total Pengajuan: ${filteredData.length}</p>`;
                    previewContent += '<ul>';
                    for (const status in statusCounts) {
                        previewContent += `<li>${getStatusDisplayName(status)}: ${statusCounts[status]}</li>`;
                    }
                    previewContent += '</ul>';
                    break;
                case 'commodity_breakdown':
                    const commodityCounts = {};
                    filteredData.forEach(app => {
                        commodityCounts[app.commodity] = (commodityCounts[app.commodity] || 0) + 1;
                    });
                    previewContent += '<h4>Rincian Pengajuan per Komoditas</h4>';
                    previewContent += `<p>Periode: ${startDate} s/d ${endDate}</p>`;
                    previewContent += '<ul>';
                    for (const commodity in commodityCounts) {
                        previewContent += `<li>${commodity}: ${commodityCounts[commodity]}</li>`;
                    }
                    previewContent += '</ul>';
                    break;
                case 'verifier_performance':
                    const verifierStats = {};
                    filteredData.forEach(app => {
                        if (!verifierStats[app.verifier]) {
                            verifierStats[app.verifier] = { total: 0, approved: 0, rejected: 0 };
                        }
                        verifierStats[app.verifier].total++;
                        if (app.status === 'persetujuan' || app.status === 'penerbitan') {
                            verifierStats[app.verifier].approved++;
                        } else if (app.status === 'penolakan') {
                            verifierStats[app.verifier].rejected++;
                        }
                    });
                    previewContent += '<h4>Kinerja Verifikator</h4>';
                    previewContent += `<p>Periode: ${startDate} s/d ${endDate}</p>`;
                    previewContent += '<ul>';
                    for (const verifier in verifierStats) {
                        previewContent += `<li>${verifier}: Total ${verifierStats[verifier].total}, Disetujui ${verifierStats[verifier].approved}, Ditolak ${verifierStats[verifier].rejected}</li>`;
                    }
                    previewContent += '</ul>';
                    break;
                case 'rejected_applications':
                    const rejectedApps = filteredData.filter(app => app.status === 'penolakan');
                    previewContent += '<h4>Daftar Pengajuan Ditolak</h4>';
                    previewContent += `<p>Periode: ${startDate} s/d ${endDate}</p>`;
                    if (rejectedApps.length > 0) {
                        previewContent += '<ul>';
                        rejectedApps.forEach(app => {
                            previewContent += `<li>${app.id} - ${app.company} (${app.commodity}) pada ${app.date}</li>`;
                        });
                        previewContent += '</ul>';
                    } else {
                        previewContent += '<p>Tidak ada pengajuan yang ditolak dalam periode ini.</p>';
                    }
                    break;
                default:
                    previewContent = '<p>Pilih jenis laporan yang valid.</p>';
            }

            reportPreview.innerHTML = previewContent;
            downloadReportBtn.style.display = 'inline-flex';
            downloadReportBtn.onclick = () => downloadReport(reportType, startDate, endDate, filteredData);
        }

        function downloadReport(reportType, startDate, endDate, data) {
            let content = `Laporan ${reportType} dari ${startDate} hingga ${endDate}\n\n`;
            switch (reportType) {
                case 'status_summary':
                    const statusCounts = {};
                    data.forEach(app => {
                        statusCounts[app.status] = (statusCounts[app.status] || 0) + 1;
                    });
                    content += `Total Pengajuan: ${data.length}\n`;
                    for (const status in statusCounts) {
                        content += `${getStatusDisplayName(status)}: ${statusCounts[status]}\n`;
                    }
                    break;
                case 'commodity_breakdown':
                    const commodityCounts = {};
                    data.forEach(app => {
                        commodityCounts[app.commodity] = (commodityCounts[app.commodity] || 0) + 1;
                    });
                    for (const commodity in commodityCounts) {
                        content += `${commodity}: ${commodityCounts[commodity]}\n`;
                    }
                    break;
                case 'verifier_performance':
                    const verifierStats = {};
                    data.forEach(app => {
                        if (!verifierStats[app.verifier]) {
                            verifierStats[app.verifier] = { total: 0, approved: 0, rejected: 0 };
                        }
                        verifierStats[app.verifier].total++;
                        if (app.status === 'persetujuan' || app.status === 'penerbitan') {
                            verifierStats[app.verifier].approved++;
                        } else if (app.status === 'penolakan') {
                            verifierStats[app.verifier].rejected++;
                        }
                    });
                    for (const verifier in verifierStats) {
                        content += `${verifier}: Total ${verifierStats[verifier].total}, Disetujui ${verifierStats[verifier].approved}, Ditolak ${verifierStats[verifier].rejected}\n`;
                    }
                    break;
                case 'rejected_applications':
                    const rejectedApps = data.filter(app => app.status === 'penolakan');
                    if (rejectedApps.length > 0) {
                        rejectedApps.forEach(app => {
                            content += `${app.id}, ${app.company}, ${app.commodity}, ${app.date}\n`;
                        });
                    } else {
                        content += 'Tidak ada pengajuan yang ditolak dalam periode ini.\n';
                    }
                    break;
            }

            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Laporan_IPSKA_${reportType}_${startDate}_${endDate}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('Laporan berhasil diunduh!');
        }


        // --- DOMContentLoaded and Event Listeners ---
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize notification dropdown
            const notificationBell = document.querySelector('.notification-bell');
            const notificationsDropdown = document.querySelector('.notifications-dropdown');
            
            notificationBell.addEventListener('click', function(e) {
                e.stopPropagation();
                notificationsDropdown.style.display = notificationsDropdown.style.display === 'block' ? 'none' : 'block';
            });
            
            document.addEventListener('click', function() {
                notificationsDropdown.style.display = 'none';
            });
            
            notificationsDropdown.addEventListener('click', function(e) {
                e.stopPropagation();
            });

            // Tab navigation
            const tabItems = document.querySelectorAll('.tab-nav-item');
            tabItems.forEach(item => {
                item.addEventListener('click', function() {
                    // Remove active class from all tabs and content
                    document.querySelectorAll('.tab-nav-item').forEach(tab => tab.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding content
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');

                    // Re-render charts/maps that might be hidden
                    if (tabId === 'overview') {
                        initExportersMap();
                        initRaceChart();
                    } else if (tabId === 'performance') {
                        initVerifierPerformanceChart();
                    } else if (tabId === 'analysis') {
                        initTrendChart();
                        initCommodityPerformanceChart();
                        initVerificationEfficiencyChart();
                        initExporterComplianceChart();
                        initPolicyImpactChart();
                        initPerformanceComparisonChart();
                        // Geographic map will be initialized when its modal is opened
                    } else if (tabId === 'personal') {
                        initMyPerformanceChart();
                    }
                });
            });

            // Application Detail Modal Tabs
            document.querySelectorAll('.app-detail-tab-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.app-detail-tab-item').forEach(tab => tab.classList.remove('active'));
                    document.querySelectorAll('.app-detail-tab-content').forEach(content => content.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById(this.getAttribute('data-tab')).classList.add('active');
                });
            });

            // Initial chart and map renders for the default active tab (Overview)
            initExportersMap();
            initRaceChart();
            
            // Initialize charts for modals (they are hidden initially, but ApexCharts needs a div to render)
            initCommodityDetailChart();
            initStatusDetailChart();

            // Initialize charts for other tabs, but they won't be visible until their tab is active
            initTrendChart();
            initCommodityPerformanceChart();
            initVerificationEfficiencyChart();
            initExporterComplianceChart();
            initPolicyImpactChart();
            initVerifierPerformanceChart();
            initPerformanceComparisonChart();
            initVerifierTimelineChart(); // Default for verifier detail modal
            initMyPerformanceChart();

            // Load recent applications table data
            const recentApplicationsTableBody = document.querySelector('#recentApplicationsTable tbody');
            recentApplicationsTableBody.innerHTML = ''; // Clear existing rows
            allApplicationsData.slice(0, 5).forEach(app => { // Show only first 5 for recent
                const row = recentApplicationsTableBody.insertRow();
                row.insertCell().textContent = app.id;
                row.insertCell().textContent = app.company;
                row.insertCell().textContent = app.commodity;
                row.insertCell().textContent = app.country;
                row.insertCell().textContent = app.date;
                const statusCell = row.insertCell();
                statusCell.innerHTML = `<span class="status-badge ${getStatusBadgeClass(app.status)}">${getStatusDisplayName(app.status)}</span>`;
                const actionCell = row.insertCell();
                actionCell.innerHTML = `<button class="btn" onclick="showApplicationDetail('${app.id}')">Detail</button>`;
            });
        });
    </script>
</body>
</html>
